<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Dashboard</title>
  <link rel="stylesheet" href="student-dashboard.css" />
</head>
<body>
  <button id="logoutBtn" class="logout-btn" style="float:right;margin:1rem;">Logout</button>
  <div class="school-header" style="display:flex;align-items:center;margin-bottom:1rem;">
    <img src="Badge.png" alt="School Logo" class="school-logo" style="height:60px;margin-right:1rem;" />
    <h1 style="margin:0;font-size:1.5rem;">Nkawkaw Nsuta M/A 'B' Basic School</h1>
  </div>
  <div class="dashboard-container">
    <!-- ðŸŒ™ Dark Mode Toggle -->
    <button id="darkModeToggle">Toggle Dark Mode</button>

    <!-- ðŸ‘‹ Welcome -->
    <h2 id="welcomeMessage">Welcome, [Student Name]</h2>

    <!-- Tabbed Navigation -->
    <div class="dashboard-tabs">
      <button class="tab-btn" onclick="showTab('profileSection')">Profile</button>
      <button class="tab-btn" onclick="showTab('assignmentsSection')">Assignments</button>
      <button class="tab-btn" onclick="showTab('resultsSection')">Results</button>
      <button class="tab-btn" onclick="showTab('submissionsSection')">Submissions</button>
      <button class="tab-btn" onclick="showTab('resourcesSection')">Resources</button>
      <button class="tab-btn" onclick="showTab('contactTeacherSection')">Contact Teacher</button>
      <button class="tab-btn" onclick="showTab('resourceRequestSection')">Request Resource</button>
      <button class="tab-btn" onclick="showTab('motivationSection')">Motivation</button>
    </div>

    <!-- ðŸ“‚ Profile Section -->
    <div id="profileSection" class="tab-section">
      <div id="studentInfo">
        <h3 id="studentName">[Student Name]</h3>
        <p id="studentClass">Class: [Class]</p>
        <p id="studentGender">Gender: [Gender]</p>
        <p id="studentInterest">Interest: [Interest]</p>
        <p id="studentConduct">Conduct: [Conduct]</p>
        <p id="studentAttendance">Attendance: [Actual/Total]</p>
      </div>
      <img id="studentPhoto" class="passport-photo" src="" alt="Student Photo" />
    </div>

    <!-- ðŸ“¥ Assignments Section -->
    <div id="assignmentsSection" class="tab-section" style="display:none;">
      <h3>Assignments</h3>
      <table>
        <thead>
          <tr>
            <th>Teacher</th>
            <th>Subject</th>
            <th>Title</th>
            <th>Term</th>
            <th>Year</th>
            <th>Status</th>
            <th>Download</th>
            <th>Teacher Feedback</th>
          </tr>
        </thead>
        <tbody id="assignmentTableBody">
          <!-- Dynamic rows -->
        </tbody>
      </table>

      <label for="assignmentSelect">Select Assignment:</label>
      <select id="assignmentSelect">
        <option value="">-- Choose --</option>
      </select>

      <label for="submissionFile">Upload Your Work:</label>
      <input type="file" id="submissionFile" />

      <button onclick="submitAssignment()">Submit Assignment</button>
    </div>

    <!-- ðŸ“ˆ Results Section -->
    <div id="resultsSection" class="tab-section" style="display:none;">
      <h3>Released Results</h3>

      <!-- ðŸ“… Term and Year Filters -->
      <div class="filters">
        <label for="termFilter">Term:</label>
        <select id="termFilter">
          <option value="">-- Select Term --</option>
          <option>1st Term</option>
          <option>2nd Term</option>
          <option>3rd Term</option>
        </select>
        <label for="yearFilter">Year:</label>
        <input type="text" id="yearFilter" placeholder="e.g. 2025/2026" />
        <button onclick="loadReleasedResults()">View Results</button>
      </div>

      <table id="releasedResultsTable">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Class Score (SBA)</th>
            <th>Exam Score</th>
            <th>Total</th>
            <th>Teacher Feedback</th>
          </tr>
        </thead>
        <tbody id="releasedResultsTableBody">
          <!-- Results will be dynamically inserted here -->
        </tbody>
      </table>

      <!-- ðŸ“Š Performance Chart -->
      <div class="performance-chart">
        <canvas id="scoreChart"></canvas>
      </div>
    </div>

    <!-- ðŸ“¥ Submissions Section -->
    <div id="submissionsSection" class="tab-section" style="display:none;">
      <h3>Submission History</h3>
      <table>
        <thead>
          <tr>
            <th>Assignment</th>
            <th>Submitted At</th>
            <th>File</th>
          </tr>
        </thead>
        <tbody id="submissionTableBody">
          <!-- Dynamic rows -->
        </tbody>
      </table>
    </div>

    <!-- ðŸ“š Resources Section -->
    <div id="resourcesSection" class="tab-section" style="display:none;">
      <h3>Study Resources</h3>
      <ul id="resourceList">
        <!-- Links to PDFs, videos, quizzes -->
      </ul>
    </div>

    <!-- Contact Teacher Section -->
    <div id="contactTeacherSection" class="tab-section" style="display:none;">
      <h3>Contact Teacher</h3>
      <form id="contactTeacherForm">
        <label for="teacherSelect">Select Teacher:</label>
        <select id="teacherSelect"></select>
        <label for="messageToTeacher">Message:</label>
        <textarea id="messageToTeacher" rows="4" placeholder="Type your question or message..."></textarea>
        <button type="button" onclick="sendMessageToTeacher()">Send</button>
      </form>
      <div id="teacherMessageStatus"></div>
    </div>

    <!-- Resource Request Section -->
    <div id="resourceRequestSection" class="tab-section" style="display:none;">
      <h3>Request Study Resource</h3>
      <form id="resourceRequestForm">
  <label for="teacherSelectResource">Teacher:</label>
  <select id="teacherSelectResource">
    <option value="">-- Select Teacher --</option>
    <!-- Teachers will be populated by JS -->
  </select>
  <label for="resourceTopic">Topic/Resource Needed:</label>
  <input type="text" id="resourceTopic" placeholder="e.g. Algebra, Essay Writing" />
  <label for="resourceReason">Reason (optional):</label>
  <input type="text" id="resourceReason" placeholder="Why do you need this resource?" />
  <button type="button" onclick="sendResourceRequest()">Request</button>
      </form>
      <div id="resourceRequestStatus"></div>
    </div>

    <!-- Motivation Section -->
    <div id="motivationSection" class="tab-section" style="display:none;">
      <h3>Motivational Messages & Announcements</h3>
      <ul id="motivationList"></ul>
    </div>
  </div>

  <!-- Supabase + Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="student-dashboard.js"></script>
    <script src="router.js"></script>
</body>
<script>
  document.getElementById('logoutBtn').onclick = function() {
    sessionStorage.clear();
    localStorage.clear();
    window.location.href = 'index.html';
  };

  function showTab(tabId) {
    // Hide all sections
    document.querySelectorAll('.tab-section').forEach(sec => sec.style.display = 'none');
    // Show selected section
    document.getElementById(tabId).style.display = 'block';
    // Highlight active tab
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    const tabBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => btn.getAttribute('onclick') && btn.getAttribute('onclick').includes(tabId));
    if (tabBtn) tabBtn.classList.add('active');
    // Lazy-load data for the tab
    if (tabId === 'profileSection') loadProfile();
    if (tabId === 'assignmentsSection') loadAssignments();
    if (tabId === 'resultsSection') loadReleasedResults();
    if (tabId === 'submissionsSection') loadSubmissions();
    if (tabId === 'resourcesSection') loadResources();
    if (tabId === 'motivationSection') loadMotivations();
    // No need to reload teacher dropdowns every time, but you can if needed:
    // if (tabId === 'contactTeacherSection' || tabId === 'resourceRequestSection') populateTeacherDropdown();
  }
  // Show profile tab by default
  showTab('profileSection');
  // Optionally, load teacher dropdowns once on page load
  if (typeof populateTeacherDropdown === 'function') populateTeacherDropdown();
</script>
</body>
</html>