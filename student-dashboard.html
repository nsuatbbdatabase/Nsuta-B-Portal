<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Dashboard</title>
  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="stylesheet" href="student-dashboard.css" />
</head>
<body>
  <!-- Session Expired Modal -->
  <div id="sessionExpiredModal" class="modal hidden" style="z-index:9999;display:flex;align-items:center;justify-content:center;">
    <div class="modal-content" style="max-width:350px;text-align:center;">
      <h3>Session Expired</h3>
      <p>Your session has expired due to inactivity.<br>Please log in again.</p>
      <button onclick="window.location.href='login.html'">Go to Login</button>
    </div>
  </div>
  <div class="student-dashboard-bg"></div>
  <div class="dashboard-bg-overlay"></div>
  <button id="logoutBtn" class="logout-btn">Logout</button>
  <div class="school-header">
  <img src="Badge.png" alt="School Logo" class="school-logo" />
  <h1 class="school-title">Nkawkaw Nsuta M/A 'B' Basic School</h1>
  </div>
  <div class="dashboard-container">
    <!-- üóìÔ∏è Floating Events Section -->
    <div id="floatingEventsSection" class="floating-events-section">
      <h3>üóìÔ∏è Events & Alerts</h3>
      <div id="eventsSlideshow" class="events-slideshow">
        <!-- Slides will be injected here -->
      </div>
    </div>
    <!-- Timetable Show/Hide Section -->
    <div class="collapsible-section">
      <button class="collapsible-btn" onclick="toggleStudentTimetable()">Show Timetable</button>
  <div id="studentTimetableWrapper" class="collapsible-content">
        <h3>Your Timetable</h3>
        <table id="studentTimetableTable">
          <thead>
            <tr><th>Day</th><th>Time</th><th>Subject</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <!-- Extra Classes Show/Hide Section -->
    <div class="collapsible-section">
      <button class="collapsible-btn" onclick="toggleStudentExtraClasses()">Show Extra Classes</button>
  <div id="studentExtraClassesWrapper" class="collapsible-content">
        <h3>Your Extra Classes</h3>
        <table id="studentExtraClassesTable">
          <thead>
            <tr><th>Day</th><th>Class</th><th>Morning Teacher</th><th>Extra Teacher</th><th>Extra Extra Teacher</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <!-- ÔøΩüåô Dark Mode Toggle -->
    <button id="darkModeToggle">Toggle Dark Mode</button>

    <!-- üëã Welcome -->
    <h2 id="welcomeMessage">Welcome, [Student Name]</h2>

    <!-- üìÇ Profile Section (Always Visible) -->
  <div id="profileSection" class="tab-section profile-section">
      <div id="studentInfo">
  <button id="openChangePinModalBtn" class="change-pin-btn" type="button">Change PIN</button>
<!-- Change PIN Modal -->
<div id="changePinModal" class="modal hidden">
  <div class="modal-content">
    <h3>Change PIN</h3>
    <form id="changePinForm">
      <label for="oldPinInput">Current PIN:</label>
      <input type="password" id="oldPinInput" required minlength="4" maxlength="8" />
      <label for="newPinInput">New PIN:</label>
      <input type="password" id="newPinInput" required minlength="4" maxlength="8" />
      <label for="confirmPinInput">Confirm New PIN:</label>
      <input type="password" id="confirmPinInput" required minlength="4" maxlength="8" />
      <button type="submit">Save</button>
      <button type="button" onclick="closeChangePinModal()">Cancel</button>
  <div id="changePinStatus"></div>
    </form>
  </div>
</div>
        <h3 id="studentName">[Student Name]</h3>
        <p id="studentClass">Class: [Class]</p>
        <p id="studentGender">Gender: [Gender]</p>
        <p id="studentInterest">Interest: [Interest]</p>
        <p id="studentConduct">Conduct: [Conduct]</p>
        <p id="studentAttendance">Attendance: [Actual/Total]</p>
      </div>
      <img id="studentPhoto" class="passport-photo" src="" alt="Student Photo" />
    </div>

    <!-- Dashboard Overview Cards -->
    <div id="dashboardOverview" class="dashboard-overview">
      <div class="dashboard-card" data-section="assignmentsSection">Assignments</div>
      <div class="dashboard-card" data-section="resultsSection">Results</div>
      <div class="dashboard-card" data-section="submissionsSection">Submissions</div>
      <div class="dashboard-card" data-section="resourcesSection">Resources</div>
      <div class="dashboard-card" data-section="contactTeacherSection">Contact Teacher</div>
      <div class="dashboard-card" data-section="resourceRequestSection">Request Resource</div>
      <div class="dashboard-card" data-section="motivationSection">Motivation</div>
    </div>

    <!-- üì• Assignments Section -->
  <div id="assignmentsSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Assignments</h3>
      <table>
        <thead>
          <tr>
            <th>Teacher</th>
            <th>Subject</th>
            <th>Title</th>
            <th>Term</th>
            <th>Year</th>
            <th>Status</th>
            <th>Download</th>
            <th>Teacher Feedback</th>
          </tr>
        </thead>
        <tbody id="assignmentTableBody">
          <!-- Dynamic rows -->
        </tbody>
      </table>

      <label for="assignmentSelect">Select Assignment:</label>
      <select id="assignmentSelect">
        <option value="">-- Choose --</option>
      </select>

      <label for="submissionFile">Upload Your Work:</label>
      <input type="file" id="submissionFile" />

      <button onclick="submitAssignment()">Submit Assignment</button>
    </div>

    <!-- üìà Results Section -->
  <div id="resultsSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Released Results</h3>

      <!-- üìÖ Term and Year Filters -->
      <div class="filters">
        <label for="termFilter">Term:</label>
        <select id="termFilter">
          <option value="">-- Select Term --</option>
          <option>1st Term</option>
          <option>2nd Term</option>
          <option>3rd Term</option>
        </select>
        <label for="yearFilter">Year:</label>
        <input type="text" id="yearFilter" placeholder="e.g. 2025/2026" />
        <button onclick="loadReleasedResults()">View Results</button>
      </div>

      <table id="releasedResultsTable">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Class Score (SBA)</th>
            <th>Exam Score</th>
            <th>Total</th>
            <th>Teacher Feedback</th>
          </tr>
        </thead>
        <tbody id="releasedResultsTableBody">
          <!-- Results will be dynamically inserted here -->
        </tbody>
      </table>

      <!-- üìä Performance Chart -->
      <div class="performance-chart">
        <canvas id="scoreChart"></canvas>
      </div>
    </div>

    <!-- üì• Submissions Section -->
  <div id="submissionsSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Submission History</h3>
      <table>
        <thead>
          <tr>
            <th>Assignment</th>
            <th>Submitted At</th>
            <th>File</th>
          </tr>
        </thead>
        <tbody id="submissionTableBody">
          <!-- Dynamic rows -->
        </tbody>
      </table>
    </div>

    <!-- üìö Resources Section -->
  <div id="resourcesSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Study Resources</h3>
  <div class="resource-filter-bar">
        <label for="resourceTypeFilter">Type:</label>
        <select id="resourceTypeFilter" onchange="filterResources()">
          <option value="">All</option>
          <option value="note">Notes</option>
          <option value="video">Videos</option>
          <option value="quiz">Quizzes</option>
          <option value="other">Other</option>
        </select>
  <input id="resourceSearch" type="text" placeholder="Search resources..." oninput="filterResources()" class="resource-search" />
      </div>
      <ul id="resourceList">
        <!-- Links to PDFs, videos, quizzes -->
      </ul>
  <div id="recommendedResources" class="recommended-resources">
        <h4>Recommended for You</h4>
        <ul id="recommendedList"></ul>
      </div>
    </div>

    <!-- Contact Teacher Section -->
  <div id="contactTeacherSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Contact Teacher</h3>
      <form id="contactTeacherForm">
        <label for="teacherSelect">Select Teacher:</label>
        <select id="teacherSelect"></select>
        <label for="messageToTeacher">Message:</label>
        <textarea id="messageToTeacher" rows="4" placeholder="Type your question or message..."></textarea>
        <button type="button" onclick="sendMessageToTeacher()">Send</button>
      </form>
      <div id="teacherMessageStatus"></div>
    </div>

    <!-- Resource Request Section -->
  <div id="resourceRequestSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Request Study Resource</h3>
      <form id="resourceRequestForm">
  <label for="teacherSelectResource">Teacher:</label>
  <select id="teacherSelectResource">
    <option value="">-- Select Teacher --</option>
    <!-- Teachers will be populated by JS -->
  </select>
  <label for="resourceTopic">Topic/Resource Needed:</label>
  <input type="text" id="resourceTopic" placeholder="e.g. Algebra, Essay Writing" />
  <label for="resourceReason">Reason (optional):</label>
  <input type="text" id="resourceReason" placeholder="Why do you need this resource?" />
  <button type="button" onclick="sendResourceRequest()">Request</button>
      </form>
      <div id="resourceRequestStatus"></div>
    </div>

    <!-- Motivation Section -->
  <div id="motivationSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Motivational Messages & Announcements</h3>
      <ul id="motivationList"></ul>
    </div>

    <!-- Study Bot Section removed -->
  </div>

  <!-- Supabase + Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="student-dashboard.js"></script>
    <script src="router.js"></script>
<script>
// --- Session Timeout Logic ---
const SESSION_TIMEOUT_MINUTES = 30; // Change as needed
let sessionTimeoutHandle;
let lastActivity = Date.now();
function resetSessionTimer() {
  lastActivity = Date.now();
  if (sessionTimeoutHandle) clearTimeout(sessionTimeoutHandle);
  sessionTimeoutHandle = setTimeout(checkSessionTimeout, SESSION_TIMEOUT_MINUTES * 60 * 1000);
}
function checkSessionTimeout() {
  const now = Date.now();
  if (now - lastActivity >= SESSION_TIMEOUT_MINUTES * 60 * 1000) {
    sessionStorage.clear();
    localStorage.clear();
    showSessionExpiredModal();
  } else {
    resetSessionTimer();
  }
}
function showSessionExpiredModal() {
  const modal = document.getElementById('sessionExpiredModal');
  if (modal) {
    modal.classList.remove('hidden');
    modal.style.display = 'flex';
  }
}
['mousemove','keydown','mousedown','touchstart','scroll'].forEach(evt => {
  window.addEventListener(evt, resetSessionTimer, true);
});
resetSessionTimer();
</script>
<script>
  // Show dashboard overview by default
  function showDashboardOverview() {
    document.getElementById('dashboardOverview').style.display = 'grid';
    document.querySelectorAll('.tab-section').forEach(section => {
      section.style.display = 'none';
    });
  }
  // Show a specific section and hide dashboard overview
  function showTabSection(tabId) {
    document.getElementById('dashboardOverview').style.display = 'none';
    document.querySelectorAll('.tab-section').forEach(section => {
      section.style.display = 'none';
    });
    var tabSection = document.getElementById(tabId);
    if (tabSection) {
      tabSection.style.display = 'block';
    } else {
      console.warn('Tab section not found:', tabId);
    }
  }
  // Add click listeners to dashboard cards
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.dashboard-card').forEach(card => {
      card.onclick = function() {
        showTabSection(card.getAttribute('data-section'));
      };
    });
    showDashboardOverview();
  });
</script>
<script>
  // Add logout logic to redirect to login.html
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.onclick = function() {
      sessionStorage.clear();
      localStorage.clear();
      window.location.href = 'login.html';
    };
  }
</script>
</body>
</html>