<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teacher Dashboard</title>
  <link rel="icon" type="image/png" href="Badge.png" />
  <link rel="stylesheet" href="teacher-dashboard.css" />
</head>
<body>
  <div class="dashboard-bg-overlay"></div>
  <button id="logoutBtn" class="logout-btn">Logout</button>
  <div class="school-header">
    <img src="Badge.png" alt="School Logo" class="school-logo" />
    <div>
      <h1 class="school-title">Nkawkaw Nsuta M/A 'B' Basic School</h1>
      <p class="motto">Knowledge is Power</p>
    </div>
  </div>
  <button id="aboutMeBtn">About Me</button>
  <!-- About Me Modal -->
  <div id="aboutMeModal" class="modal hidden">
    <div class="modal-content">
  <span class="close" id="closeAboutMe" onclick="closeAboutMeModal()">&times;</span>
      <h2>About Me</h2>
      <div id="aboutMeContent">
        <!-- Teacher info will be loaded here -->
      </div>
    </div>
  </div>
  <div class="dashboard-container">
    <!-- Change PIN Modal -->
    <div id="changePinModal" class="modal hidden">
      <div class="modal-content">
        <span class="close" onclick="closeChangePinModal()">&times;</span>
        <h2>Change Login PIN</h2>
        <form id="changePinForm">
          <label for="currentPin">Current PIN:</label>
          <input type="password" id="currentPin" name="currentPin" required />
          <label for="newPin">New PIN:</label>
          <input type="password" id="newPin" name="newPin" required minlength="4" maxlength="8" />
          <button type="submit">Change PIN</button>
        </form>
      </div>
    </div>
    <!-- Teacher Welcome and Roles -->
    <div class="teacher-header">
  <h2 id="welcomeMessage">Welcome, [Teacher Name]</h2>
  <div id="assignedRoles" class="floating-roles"></div>
  <button id="changePinBtn">Change Login PIN</button>
    </div>
    <!-- Dashboard Overview Cards -->
    <div id="dashboardOverview" class="dashboard-overview">
  <div class="dashboard-card about-me-card" data-section="aboutMeSection">About Me</div>
  <div class="dashboard-card" data-section="promotionExamSection">Promotion Exam Entry</div>
      <div class="dashboard-card" data-section="studentListSection">Student List</div>
      <div class="dashboard-card" data-section="attendanceSection">Attendance</div>
      <div class="dashboard-card" data-section="sbaSection">SBA Entry</div>
      <div class="dashboard-card" data-section="examSection">Exam Entry</div>
      <div class="dashboard-card" data-section="assignmentSection">Assignment Composer</div>
      <div class="dashboard-card" data-section="inboxSection">Assignment Inbox</div>
      <div class="dashboard-card" data-section="messagesSection">Messages</div>
      <div class="dashboard-card" data-section="resourceRequestsSection">Resource Requests</div>
      <div class="dashboard-card" data-section="motivationSection">Motivation</div>
  <!-- End of dashboard cards -->
<style>
@media (max-width: 700px) {
  #aboutMeBtn {
    display: none !important;
  }
  .about-me-card {
    display: flex !important;
  }
  .dashboard-overview {
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    grid-auto-rows: minmax(70px, 1fr);
    min-height: 100vh;
    height: 100vh;
    max-height: 100vh;
    overflow-y: auto;
  }
}
</style>
    </div>
    <!-- Attendance Section -->
  <div id="attendanceSection" class="tab-section">
      <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="collapsible-panel">
        <button class="toggle-btn" onclick="togglePanel('attendancePanel')">Attendance</button>
        <div id="attendancePanel" class="panel-content">
          <div class="filters">
            <label for="attendanceClassSelect">Class:</label>
            <select id="attendanceClassSelect">
              <option value="">-- Select Class --</option>
            </select>
            <label for="attendanceDate">Date:</label>
            <input type="date" id="attendanceDate" />
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>
                  Status<br>
                  <input type="checkbox" id="checkAllPresent" title="Check all as Present" /> Present (Check All)
                </th>
                <th>Late</th>
              </tr>
            </thead>
            <tbody id="attendanceTableBody"></tbody>
          </table>
          <button onclick="submitAttendance()">Submit Attendance</button>
        </div>
      </div>
    </div>
    </div>

   

  <div id="sbaSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="collapsible-panel">
        <button class="toggle-btn" onclick="togglePanel('sbaPanel')">SBA Entry</button>
        <div id="sbaPanel" class="panel-content">
          <div class="filters">
            <label for="classSelect">Class:</label>
            <select id="classSelect" onchange="loadStudents()">
              <option value="">-- Select Class --</option>
            </select>
            <label for="subjectSelect">Subject:</label>
            <select id="subjectSelect" onchange="loadStudents()">
              <option value="">-- Select Subject --</option>
            </select>
            <label for="termInput">Term:</label>
            <select id="termInput" onchange="loadStudents()">
              <option value="">-- Select Term --</option>
              <option value="1st Term">1st Term</option>
              <option value="2nd Term">2nd Term</option>
              <option value="3rd Term">3rd Term</option>
            </select>
            <label for="yearInput">Academic Year:</label>
            <input id="yearInput" placeholder="Academic Year (e.g. 2025/2026)" oninput="loadStudents()">
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>Individual Test (15)</th>
                <th>Group Work (15)</th>
                <th>Class Test (15)</th>
                <th>Project Work (15)</th>
                <th>Total (60)</th>
                <th>Scaled to 50</th>
              </tr>
            </thead>
            <tbody id="sbaTableBody"></tbody>
          </table>
          <button onclick="submitSBA()">Submit SBA</button>
        </div>
      </div>
    </div>

  <div id="examSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="collapsible-panel">
        <button class="toggle-btn" onclick="togglePanel('examPanel')">Exam Entry</button>
        <div id="examPanel" class="panel-content">
          <div class="filters">
            <label for="classSelectExam">Class:</label>
            <select id="classSelectExam" onchange="loadStudents()">
              <option value="">-- Select Class --</option>
            </select>
            <label for="subjectSelectExam">Subject:</label>
            <select id="subjectSelectExam" onchange="loadStudents()">
              <option value="">-- Select Subject --</option>
            </select>
            <label for="termInputExam">Term:</label>
            <select id="termInputExam">
              <option value="">-- Select Term --</option>
              <option value="1st Term">1st Term</option>
              <option value="2nd Term">2nd Term</option>
              <option value="3rd Term">3rd Term</option>
            </select>
            <label for="yearInputExam">Academic Year:</label>
            <input id="yearInputExam" placeholder="Academic Year (e.g. 2025/2026)">
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>End of Term Exam (100)</th>
                <th>Scaled to 50</th>
              </tr>
            </thead>
            <tbody id="examTableBody"></tbody>
          </table>
          <button onclick="submitExams()">Submit Exams</button>
        </div>
      </div>
    </div>

  <div id="assignmentSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="assignment-composer">
        <h3>Send Assignment to Students</h3>
        <div class="filters">
          <label for="assignClass">Class:</label>
          <select id="assignClass">
            <option value="">-- Select Class --</option>
          </select>
          <label for="assignSubject">Subject:</label>
          <select id="assignSubject">
            <option value="">-- Select Subject --</option>
          </select>
          <label for="assignTerm">Term:</label>
          <select id="assignTerm">
            <option value="">-- Select Term --</option>
            <option value="1st Term">1st Term</option>
            <option value="2nd Term">2nd Term</option>
            <option value="3rd Term">3rd Term</option>
          </select>
          <label for="assignYear">Academic Year:</label>
          <input type="text" id="assignYear" placeholder="e.g. 2025/2026" />
        </div>
        <label for="assignTitle">Assignment Title:</label>
        <input type="text" id="assignTitle" placeholder="e.g. Algebra Practice" />
        <label for="assignText">Instructions:</label>
        <textarea id="assignText" rows="4" placeholder="Describe the task..."></textarea>
        <label for="assignFile">Upload Document (optional):</label>
        <input type="file" id="assignFile" />
        <button onclick="sendAssignment()">Send Assignment</button>
      </div>
    </div>

  <div id="inboxSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div id="assignmentInbox">
        <h3>Student Assignment Submissions</h3>
        <table>
          <thead>
            <tr>
              <th>Student</th>
              <th>Assignment</th>
              <th>Date Submitted</th>
              <th>File</th>
              <th>ID</th>
            </tr>
          </thead>
          <tbody id="studentSubmissionTableBody">
            <!-- Submissions will be loaded here by JS -->
          </tbody>
        </table>
      </div>
    </div>

  <div id="messagesSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Messages from Students</h3>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Message</th>
            <th>Response</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="studentMessagesTableBody">
          <!-- Messages will be loaded here by JS -->
        </tbody>
      </table>
    </div>

  <div id="resourceRequestsSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Resource Requests</h3>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Resource</th>
            <th>Reason</th>
            <th>Response</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="resourceRequestsTableBody">
          <!-- Requests will be loaded here by JS -->
        </tbody>
      </table>
    </div>

  <div id="motivationSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Send Motivational Message</h3>
      <label for="motivationStudentSelect">Student:</label>
      <select id="motivationStudentSelect">
        <option value="">-- Select Student --</option>
        <!-- Student options will be populated by JS -->
      </select>
      <label for="motivationText">Message:</label>
      <input type="text" id="motivationText" placeholder="Type your message..." />
      <button onclick="sendMotivationalMessage()">Send</button>
      <h4>Motivational Messages Sent</h4>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Message</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="motivationalMessagesTableBody">
          <!-- Messages will be loaded here by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Student List Section -->
  <!-- Promotion Exam Section -->
  <div id="promotionExamSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
    <h3>Promotion Exam Entry (JHS 2)</h3>
    <div class="filters">
      <label for="promotionClassSelect">Class:</label>
      <select id="promotionClassSelect">
        <option value="JHS 2">JHS 2</option>
      </select>
      <label for="promotionSubjectSelect">Subject:</label>
      <select id="promotionSubjectSelect">
        <option value="">-- Select Subject --</option>
      </select>
      <label for="promotionTermInput">Term:</label>
      <select id="promotionTermInput">
        <option value="">-- Select Term --</option>
        <option value="Promotion">Promotion</option>
      </select>
      <label for="promotionYearInput">Academic Year:</label>
      <input id="promotionYearInput" placeholder="Academic Year (e.g. 2025/2026)">
    </div>
    <table>
      <thead>
        <tr>
          <th>Student</th>
          <th>Score (100)</th>
        </tr>
      </thead>
      <tbody id="promotionExamTableBody"></tbody>
    </table>
    <button onclick="submitPromotionExam()">Submit Promotion Exam</button>
  </div>
  <div id="studentListSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Students in Your Assigned Classes</h3>
      <div class="filters">
        <label for="studentClassFilter">Class:</label>
        <select id="studentClassFilter">
          <option value="">-- All Assigned Classes --</option>
        </select>
      </div>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Class</th>
            <th>Gender</th>
            <th>DOB</th>
            <th>Parent</th>
            <th>Contact</th>
            <th>NHIS</th>
          </tr>
        </thead>
        <tbody id="studentListTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Supabase + Logic -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="teacher-dashboard.js"></script>
  <script src="router.js"></script>
</body>
<script>
  // Modal controls
  function openAboutMeModal() {
    document.getElementById('aboutMeModal').classList.remove('hidden');
  }
  function closeAboutMeModal() {
    document.getElementById('aboutMeModal').classList.add('hidden');
  }
  document.getElementById('aboutMeBtn').onclick = async function() {
    const staffId = sessionStorage.getItem('teacher_staff_id');
    if (!staffId) {
      document.getElementById('aboutMeContent').innerHTML = '<p style="color:red;">No teacher session found. Please log in again.</p>';
      openAboutMeModal();
      return;
    }
    const { data, error } = await supabase.createClient(
      'https://omhmahhfeduejykrxflx.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9taG1haGhmZWR1ZWp5a3J4Zmx4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MDI5NDAsImV4cCI6MjA3MjM3ODk0MH0.UL7cRM4JUEZRqhXarRf8xQDyobvoOxa8eXfG8h9wNHo'
    ).from('teachers').select('*').eq('staff_id', staffId).single();
    if (error || !data) {
      document.getElementById('aboutMeContent').innerHTML = '<p style="color:red;">Could not load teacher info. Please log in again.</p>';
      openAboutMeModal();
      return;
    }
    let html = '<table class="about-me-table">';
    for (const [key, value] of Object.entries(data)) {
      html += `<tr><td><strong>${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</strong></td><td>${Array.isArray(value) ? value.join(', ') : value || ''}</td></tr>`;
    }
    html += '</table>';
    document.getElementById('aboutMeContent').innerHTML = html;
    openAboutMeModal();
  };
  // Allow closing modal by clicking outside or pressing Escape
  window.onclick = function(event) {
    const modal = document.getElementById('aboutMeModal');
    if (event.target === modal) {
      closeAboutMeModal();
    }
  };
  window.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') closeAboutMeModal();
  });
</script>
<script>
  // Show dashboard overview by default
  function showDashboardOverview() {
    document.getElementById('dashboardOverview').style.display = 'grid';
    document.querySelectorAll('.tab-section').forEach(section => {
      section.style.display = 'none';
    });
  }
  // Show a specific section and hide dashboard overview
  function showTabSection(tabId) {
    document.getElementById('dashboardOverview').style.display = 'none';
    document.querySelectorAll('.tab-section').forEach(section => {
      section.style.display = 'none';
    });
    var tabSection = document.getElementById(tabId);
    if (tabSection) {
      tabSection.style.display = 'block';
    } else {
      console.warn('Tab section not found:', tabId);
    }
  }
  // Add click listeners to dashboard cards
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.dashboard-card').forEach(card => {
      // On mobile, About Me card opens modal, others show tab
      if (card.classList.contains('about-me-card')) {
        card.onclick = function(e) {
          // Only trigger on mobile view
          if (window.innerWidth <= 700) {
            document.getElementById('aboutMeBtn').click();
          } else {
            // On desktop, do nothing (card is hidden anyway)
            e.preventDefault();
            return false;
          }
        };
      } else {
        card.onclick = function() {
          showTabSection(card.getAttribute('data-section'));
        };
      }
    });
    showDashboardOverview();
  });
</script>
</body>
<script>
  document.getElementById('logoutBtn').onclick = function() {
    if (typeof logout === 'function') {
      logout();
    } else {
      // fallback: clear session and redirect
      sessionStorage.clear();
      localStorage.clear();
      sessionStorage.removeItem('teacher_staff_id');
      localStorage.removeItem('teacherId');
      window.location.href = 'index.html';
    }
  };
</script>
</body>
</html>