<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Teacher Dashboard</title>
  <link rel="icon" type="image/png" href="Badge.png" />
  <link rel="stylesheet" href="teacher-dashboard.css" />
  <style>
    body {
      background: linear-gradient(120deg, #e3e8f0 0%, #f7f9fc 100%);
      min-height: 100vh;
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
    }
    .dashboard-bg-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      width: 100vw; height: 100vh;
      background: linear-gradient(120deg, rgba(0,32,64,0.08) 0%, rgba(0,32,64,0.04) 100%);
      z-index: 0;
      pointer-events: none;
    }
    .dashboard-container {
      position: relative;
      z-index: 1;
      max-width: 900px;
      margin: 3rem auto 2rem auto;
      background: rgba(255,255,255,0.97);
      box-shadow: 0 8px 32px rgba(0,0,0,0.10), 0 1.5px 8px rgba(0,32,64,0.08);
      border-radius: 18px;
      padding: 2.5rem 2rem 2rem 2rem;
    }
    .school-header {
      display: flex;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    .school-logo {
      height: 70px;
      margin-right: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
    }
    .school-title {
      margin: 0;
      font-size: 2rem;
      color: #003366;
      font-weight: 700;
    }
    .motto {
      margin: 0.2rem 0 0 0;
      font-size: 1.1rem;
      color: #0074d9;
      font-style: italic;
    }
    .dashboard-overview {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      justify-content: center;
      margin-bottom: 2rem;
    }
    .dashboard-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      padding: 1.2rem 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.2s;
      width: 180px;
      border: 2px solid #e3e8f0;
      font-size: 1.1rem;
      font-weight: 600;
      color: #003366;
    }
    .dashboard-card:hover {
      box-shadow: 0 8px 32px rgba(0,32,64,0.18);
      transform: translateY(-4px) scale(1.04);
      border-color: #0074d9;
      background: #f7f9fc;
    }
    .logout-btn {
      float: right;
      margin: 1rem;
      position: relative;
      z-index: 2;
      background: #e3e8f0;
      color: #003366;
      border: none;
      border-radius: 8px;
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    .logout-btn:hover {
      background: #cdd6e6;
    }
    /* #aboutMeBtn style moved to teacher-dashboard.css for consistency */
    .tab-section {
      display: none;
    }
    .tab-section.active {
      display: block;
    }
    @media (max-width: 700px) {
      .dashboard-container {
        padding: 1rem 0.3rem;
        border-radius: 10px;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .school-logo {
        height: 40px;
        margin-right: 0.5rem;
      }
      .school-title {
        font-size: 1.1rem;
      }
      .dashboard-overview {
        flex-direction: column;
        gap: 1.2rem;
        align-items: center;
      }
      .dashboard-card {
        width: 90vw;
        min-width: 180px;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-bg-overlay"></div>
  <button id="logoutBtn" class="logout-btn">Logout</button>
  <div class="school-header">
    <img src="Badge.png" alt="School Logo" class="school-logo" />
    <div>
      <h1 class="school-title">Nkawkaw Nsuta M/A 'B' Basic School</h1>
      <p class="motto">Empowering the Future</p>
    </div>
  </div>
  <button id="aboutMeBtn">About Me</button>
  <!-- About Me Modal -->
  <div id="aboutMeModal" class="modal hidden">
    <div class="modal-content">
  <span class="close" id="closeAboutMe" onclick="closeAboutMeModal()">&times;</span>
      <h2>About Me</h2>
      <div id="aboutMeContent">
        <!-- Teacher info will be loaded here -->
      </div>
    </div>
  </div>
  <div class="dashboard-container">
    <!-- Change PIN Modal -->
    <div id="changePinModal" class="modal hidden">
      <div class="modal-content">
        <span class="close" onclick="closeChangePinModal()">&times;</span>
        <h2>Change Login PIN</h2>
        <form id="changePinForm">
          <label for="currentPin">Current PIN:</label>
          <input type="password" id="currentPin" name="currentPin" required />
          <label for="newPin">New PIN:</label>
          <input type="password" id="newPin" name="newPin" required minlength="4" maxlength="8" />
          <button type="submit">Change PIN</button>
        </form>
      </div>
    </div>
    <!-- Teacher Welcome and Roles -->
    <div class="teacher-header">
  <h2 id="welcomeMessage">Welcome, [Teacher Name]</h2>
  <div id="assignedRoles" class="floating-roles"></div>
  <button id="changePinBtn" style="margin-left:1rem;">Change Login PIN</button>
    </div>
    <!-- Dashboard Overview Cards -->
    <div id="dashboardOverview" class="dashboard-overview">
  <!-- Profile card removed -->
  <div class="dashboard-card" data-section="promotionExamSection">Promotion Exam Entry</div>
      <div class="dashboard-card" data-section="studentListSection">Student List</div>
      <div class="dashboard-card" data-section="attendanceSection">Attendance</div>
      <div class="dashboard-card" data-section="sbaSection">SBA Entry</div>
      <div class="dashboard-card" data-section="examSection">Exam Entry</div>
      <div class="dashboard-card" data-section="assignmentSection">Assignment Composer</div>
      <div class="dashboard-card" data-section="inboxSection">Assignment Inbox</div>
      <div class="dashboard-card" data-section="messagesSection">Messages</div>
      <div class="dashboard-card" data-section="resourceRequestsSection">Resource Requests</div>
      <div class="dashboard-card" data-section="motivationSection">Motivation</div>
    </div>
    <!-- Attendance Section -->
  <div id="attendanceSection" class="tab-section">
      <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="collapsible-panel">
        <button class="toggle-btn" onclick="togglePanel('attendancePanel')">Attendance</button>
        <div id="attendancePanel" class="panel-content">
          <div class="filters">
            <label for="attendanceClassSelect">Class:</label>
            <select id="attendanceClassSelect">
              <option value="">-- Select Class --</option>
            </select>
            <label for="attendanceDate">Date:</label>
            <input type="date" id="attendanceDate" />
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="attendanceTableBody"></tbody>
          </table>
          <button onclick="submitAttendance()">Submit Attendance</button>
        </div>
      </div>
    </div>
    </div>

   

  <div id="sbaSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="collapsible-panel">
        <button class="toggle-btn" onclick="togglePanel('sbaPanel')">SBA Entry</button>
        <div id="sbaPanel" class="panel-content">
          <div class="filters">
            <label for="classSelect">Class:</label>
            <select id="classSelect" onchange="loadStudents()">
              <option value="">-- Select Class --</option>
            </select>
            <label for="subjectSelect">Subject:</label>
            <select id="subjectSelect" onchange="loadStudents()">
              <option value="">-- Select Subject --</option>
            </select>
            <label for="termInput">Term:</label>
            <select id="termInput" onchange="loadStudents()">
              <option value="">-- Select Term --</option>
              <option value="1st Term">1st Term</option>
              <option value="2nd Term">2nd Term</option>
              <option value="3rd Term">3rd Term</option>
            </select>
            <label for="yearInput">Academic Year:</label>
            <input id="yearInput" placeholder="Academic Year (e.g. 2025/2026)" oninput="loadStudents()">
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>Individual Test (15)</th>
                <th>Group Work (15)</th>
                <th>Class Test (15)</th>
                <th>Project Work (15)</th>
                <th>Total (60)</th>
                <th>Scaled to 50</th>
              </tr>
            </thead>
            <tbody id="sbaTableBody"></tbody>
          </table>
          <button onclick="submitSBA()">Submit SBA</button>
        </div>
      </div>
    </div>

  <div id="examSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="collapsible-panel">
        <button class="toggle-btn" onclick="togglePanel('examPanel')">Exam Entry</button>
        <div id="examPanel" class="panel-content">
          <div class="filters">
            <label for="classSelectExam">Class:</label>
            <select id="classSelectExam" onchange="loadStudents()">
              <option value="">-- Select Class --</option>
            </select>
            <label for="subjectSelectExam">Subject:</label>
            <select id="subjectSelectExam" onchange="loadStudents()">
              <option value="">-- Select Subject --</option>
            </select>
            <label for="termInputExam">Term:</label>
            <select id="termInputExam">
              <option value="">-- Select Term --</option>
              <option value="1st Term">1st Term</option>
              <option value="2nd Term">2nd Term</option>
              <option value="3rd Term">3rd Term</option>
            </select>
            <label for="yearInputExam">Academic Year:</label>
            <input id="yearInputExam" placeholder="Academic Year (e.g. 2025/2026)">
          </div>
          <table>
            <thead>
              <tr>
                <th>Student</th>
                <th>End of Term Exam (100)</th>
                <th>Scaled to 50</th>
              </tr>
            </thead>
            <tbody id="examTableBody"></tbody>
          </table>
          <button onclick="submitExams()">Submit Exams</button>
        </div>
      </div>
    </div>

  <div id="assignmentSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div class="assignment-composer">
        <h3>Send Assignment to Students</h3>
        <div class="filters">
          <label for="assignClass">Class:</label>
          <select id="assignClass">
            <option value="">-- Select Class --</option>
          </select>
          <label for="assignSubject">Subject:</label>
          <select id="assignSubject">
            <option value="">-- Select Subject --</option>
          </select>
          <label for="assignTerm">Term:</label>
          <select id="assignTerm">
            <option value="">-- Select Term --</option>
            <option value="1st Term">1st Term</option>
            <option value="2nd Term">2nd Term</option>
            <option value="3rd Term">3rd Term</option>
          </select>
          <label for="assignYear">Academic Year:</label>
          <input type="text" id="assignYear" placeholder="e.g. 2025/2026" />
        </div>
        <label for="assignTitle">Assignment Title:</label>
        <input type="text" id="assignTitle" placeholder="e.g. Algebra Practice" />
        <label for="assignText">Instructions:</label>
        <textarea id="assignText" rows="4" placeholder="Describe the task..."></textarea>
        <label for="assignFile">Upload Document (optional):</label>
        <input type="file" id="assignFile" />
        <button onclick="sendAssignment()">Send Assignment</button>
      </div>
    </div>

  <div id="inboxSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <div id="assignmentInbox">
        <h3>Student Assignment Submissions</h3>
        <table>
          <thead>
            <tr>
              <th>Student</th>
              <th>Assignment</th>
              <th>Date Submitted</th>
              <th>File</th>
              <th>ID</th>
            </tr>
          </thead>
          <tbody id="studentSubmissionTableBody">
            <!-- Submissions will be loaded here by JS -->
          </tbody>
        </table>
      </div>
    </div>

  <div id="messagesSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Messages from Students</h3>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Message</th>
            <th>Response</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="studentMessagesTableBody">
          <!-- Messages will be loaded here by JS -->
        </tbody>
      </table>
    </div>

  <div id="resourceRequestsSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Resource Requests</h3>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Resource</th>
            <th>Reason</th>
            <th>Response</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="resourceRequestsTableBody">
          <!-- Requests will be loaded here by JS -->
        </tbody>
      </table>
    </div>

  <div id="motivationSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Send Motivational Message</h3>
      <label for="motivationStudentSelect">Student:</label>
      <select id="motivationStudentSelect">
        <option value="">-- Select Student --</option>
        <!-- Student options will be populated by JS -->
      </select>
      <label for="motivationText">Message:</label>
      <input type="text" id="motivationText" placeholder="Type your message..." />
      <button onclick="sendMotivationalMessage()">Send</button>
      <h4>Motivational Messages Sent</h4>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Message</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="motivationalMessagesTableBody">
          <!-- Messages will be loaded here by JS -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Student List Section -->
  <!-- Promotion Exam Section -->
  <div id="promotionExamSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
    <h3>Promotion Exam Entry (JHS 2)</h3>
    <div class="filters">
      <label for="promotionClassSelect">Class:</label>
      <select id="promotionClassSelect">
        <option value="JHS 2">JHS 2</option>
      </select>
      <label for="promotionSubjectSelect">Subject:</label>
      <select id="promotionSubjectSelect">
        <option value="">-- Select Subject --</option>
      </select>
      <label for="promotionTermInput">Term:</label>
      <select id="promotionTermInput">
        <option value="">-- Select Term --</option>
        <option value="Promotion">Promotion</option>
      </select>
      <label for="promotionYearInput">Academic Year:</label>
      <input id="promotionYearInput" placeholder="Academic Year (e.g. 2025/2026)">
    </div>
    <table>
      <thead>
        <tr>
          <th>Student</th>
          <th>Score (100)</th>
        </tr>
      </thead>
      <tbody id="promotionExamTableBody"></tbody>
    </table>
    <button onclick="submitPromotionExam()">Submit Promotion Exam</button>
  </div>
  <div id="studentListSection" class="tab-section">
    <button class="back-to-dashboard" onclick="showDashboardOverview()">&larr; Back to Dashboard</button>
      <h3>Students in Your Assigned Classes</h3>
      <div class="filters">
        <label for="studentClassFilter">Class:</label>
        <select id="studentClassFilter">
          <option value="">-- All Assigned Classes --</option>
        </select>
      </div>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Class</th>
            <th>Gender</th>
            <th>DOB</th>
            <th>Parent</th>
            <th>Contact</th>
            <th>NHIS</th>
          </tr>
        </thead>
        <tbody id="studentListTableBody"></tbody>
      </table>
    </div>
  </div>

  <!-- Supabase + Logic -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="teacher-dashboard.js"></script>
  <script src="router.js"></script>
</body>
<script>
  // Modal controls
  function openAboutMeModal() {
    document.getElementById('aboutMeModal').classList.remove('hidden');
  }
  function closeAboutMeModal() {
    document.getElementById('aboutMeModal').classList.add('hidden');
  }
  document.getElementById('aboutMeBtn').onclick = async function() {
    const staffId = sessionStorage.getItem('teacher_staff_id');
    if (!staffId) {
      document.getElementById('aboutMeContent').innerHTML = '<p style="color:red;">No teacher session found. Please log in again.</p>';
      openAboutMeModal();
      return;
    }
    const { data, error } = await supabase.createClient(
      'https://omhmahhfeduejykrxflx.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9taG1haGhmZWR1ZWp5a3J4Zmx4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY4MDI5NDAsImV4cCI6MjA3MjM3ODk0MH0.UL7cRM4JUEZRqhXarRf8xQDyobvoOxa8eXfG8h9wNHo'
    ).from('teachers').select('*').eq('staff_id', staffId).single();
    if (error || !data) {
      document.getElementById('aboutMeContent').innerHTML = '<p style="color:red;">Could not load teacher info. Please log in again.</p>';
      openAboutMeModal();
      return;
    }
    let html = '<table class="about-me-table">';
    for (const [key, value] of Object.entries(data)) {
      html += `<tr><td><strong>${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</strong></td><td>${Array.isArray(value) ? value.join(', ') : value || ''}</td></tr>`;
    }
    html += '</table>';
    document.getElementById('aboutMeContent').innerHTML = html;
    openAboutMeModal();
  };
  // Allow closing modal by clicking outside or pressing Escape
  window.onclick = function(event) {
    const modal = document.getElementById('aboutMeModal');
    if (event.target === modal) {
      closeAboutMeModal();
    }
  };
  window.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') closeAboutMeModal();
  });
</script>
<script>
  // Show dashboard overview by default
  function showDashboardOverview() {
    document.getElementById('dashboardOverview').style.display = 'grid';
    document.querySelectorAll('.tab-section').forEach(section => {
      section.style.display = 'none';
    });
  }
  // Show a specific section and hide dashboard overview
  function showTabSection(tabId) {
    document.getElementById('dashboardOverview').style.display = 'none';
    document.querySelectorAll('.tab-section').forEach(section => {
      section.style.display = 'none';
    });
    var tabSection = document.getElementById(tabId);
    if (tabSection) {
      tabSection.style.display = 'block';
    } else {
      console.warn('Tab section not found:', tabId);
    }
  }
  // Add click listeners to dashboard cards
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.dashboard-card').forEach(card => {
      card.onclick = function() {
        showTabSection(card.getAttribute('data-section'));
      };
    });
    showDashboardOverview();
  });
</script>
</body>
<script>
  document.getElementById('logoutBtn').onclick = function() {
    if (typeof logout === 'function') {
      logout();
    } else {
      // fallback: clear session and redirect
      sessionStorage.clear();
      localStorage.clear();
      sessionStorage.removeItem('teacher_staff_id');
      localStorage.removeItem('teacherId');
      window.location.href = 'index.html';
    }
  };
</script>
</body>
</html>