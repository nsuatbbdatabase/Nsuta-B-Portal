<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Admin Dashboard ‚Äî Nsuta B Portal</title>
	<link rel="stylesheet" href="dashboard.css" />
	<style>
	/* Flip-card styles for the KPI tiles (front/back rotation) */
	/* Use a responsive grid so tiles align nicely on all screens. Individual flip-cards
	   are flexible (full-width within a grid column) and their inner content adapts. */
	.tiles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; }
	.flip-card { width: 100%; height: auto; perspective: 1000px; }
	.flip-card-inner { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.6s; min-height: 110px; }
	.flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
	.flip-card-front, .flip-card-back { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 8px; box-shadow: 0 6px 18px rgba(16,24,40,0.06); display:flex; align-items:center; }
	.flip-card-front { background: linear-gradient(180deg,#fff,#f7fbff); padding:0.85rem; box-sizing: border-box; }
	.flip-card-back { background: linear-gradient(180deg,#0ea5a4,#047857); color: #fff; transform: rotateY(180deg); padding:0.85rem; cursor:pointer; box-sizing: border-box; }
	.flip-card .icon { font-size:28px; margin-right:0.6rem; }
	.flip-card .body { flex:1; }
	.flip-card .title { font-weight:600; font-size:0.95rem; }
	.flip-card .value { font-size:1.4rem; margin-top:0.25rem; }
	.flip-card-back .back-title { font-weight:700; font-size:1rem; margin-bottom:0.25rem; }
	.flip-card-back .back-desc { font-size:0.92rem; opacity:0.95; }
	.flip-card:focus { outline: 3px solid rgba(2,132,199,0.12); }
	</style>
	<style>
	  /* Make wide tables horizontally scrollable so Actions and extra columns remain reachable.
		  Also allow vertical scrolling when table content grows (useful when the section is shown
		  in a modal). Using a max-height keeps the table usable inside modals on mobile screens. */
	  .table-scroll { overflow-x: auto; width: 100%; max-height: 60vh; overflow-y: auto; }
	  /* Default desktop behavior keeps wider tables so columns stay aligned */
	  .table-scroll table { border-collapse: collapse; width: 100%; min-width: 900px; table-layout: auto; }
	  .table-scroll th, .table-scroll td { white-space: nowrap; padding: 0.6rem; }

	  /* Mobile: make tables friendlier on narrow screens
	     - reduce forced min widths
	     - allow cells to wrap and use a stacked layout when necessary
	     - preserve horizontal scrolling for very wide tables but try to fit content first */
	  @media (max-width: 900px) {
	    /* Layout: stack header and actions, compact brand */
	    .admin-top { display:flex; flex-direction:column; gap:0.6rem; align-items:flex-start; }
	    .brand { display:flex; gap:0.6rem; align-items:center; }
	    .brand h1 { font-size:1.05rem; margin:0; }
	    .brand .muted-small { display:none; }

	    /* Actions: full-width stacked buttons for easy tapping */
	    .actions-right { width:100%; display:flex; justify-content:flex-end; }
	    .quick-actions { display:flex; gap:0.5rem; flex-wrap:wrap; width:100%; }
	    .quick-actions .action-btn { flex:1 1 48%; min-width: 48%; padding:0.8rem; font-size:0.98rem; }

	    /* Tiles: full-width large touch targets, stacked vertically */
	    .tiles-grid { display:flex; flex-direction:column; gap:0.65rem; align-items:stretch; }
	    .flip-card { width:100% !important; height:auto !important; }
	    .flip-card .flip-card-inner { min-height: 88px; }
	    .flip-card-front, .flip-card-back { position:relative; height:auto; backface-visibility: visible; padding:0.9rem; }

	    /* Overview cards stack and become full-width */
	    .dashboard-cards { display:flex; flex-direction:column; gap:0.6rem; }
	    .dashboard-card, .dashboard-card.small { width:100%; box-sizing:border-box; }

	    /* Tables: hide bulky table view on mobile in favor of modal 'Open list' button */
	    .mobile-list-toggle { display:block; margin-bottom:0.5rem; }
	    .mobile-list-toggle .action-btn { width:100%; padding:0.7rem; font-size:1rem; }
	    /* Keep table scroll available but reduce min-width so it fits better when needed */
	    .table-scroll table { min-width: auto; table-layout: fixed; }
	    .table-scroll th, .table-scroll td { white-space: normal; word-wrap:break-word; padding:0.5rem; font-size:0.95rem; }

	    /* Reduce spacing and scale form controls for mobile */
	    .modal .modal-body { padding: 0.75rem; }
	    .modal .modal-body .form-group label { font-size:0.92rem; }
	    .modal .modal-body .form-group input, .modal .modal-body .form-group select, .modal .modal-body .form-group textarea { padding:0.45rem; }

	    /* Make modals full screen and easier to interact with on phones */
	    .modal { align-items: flex-end; }
	    .modal .modal-content { width:100% !important; height:100% !important; max-width:100% !important; border-radius:0 !important; margin:0 !important; padding:0.6rem !important; box-sizing:border-box; }
	    .modal .modal-content .modal-header { padding:0.5rem 0.6rem; }

	    /* Ensure action buttons are full width for easier tapping */
	    .form-actions { flex-direction: column; gap:0.5rem; }
	    .form-actions button { width:100%; }

	    /* Improve legibility and touch performance */
	    body { font-size: 15px; }
	  }
	</style>
	<style>/* small page-specific overrides */
		body { background: linear-gradient(180deg,#f6fbff,#f4f6f8); }
		/* Modal form spacing to match sample.html layout */
		.modal .modal-body { padding: 1rem 1.25rem; }
		.modal .modal-body .form-group { margin-bottom: 0.65rem; display:block; }
		.modal .modal-body .form-group label { display:block; margin-bottom:0.25rem; font-size:0.95rem; }
		.modal .modal-body .form-group input[type="text"],
		.modal .modal-body .form-group input[type="email"],
		.modal .modal-body .form-group input[type="tel"],
		.modal .modal-body .form-group input[type="date"],
		.modal .modal-body .form-group input[type="number"],
		.modal .modal-body .form-group select,
		.modal .modal-body .form-group textarea { width:100%; box-sizing:border-box; padding:0.45rem 0.6rem; border-radius:6px; border:1px solid #d1d5db; }
		.modal .modal-body .class-select-row { display:flex; gap:0.5rem; align-items:center; }
		/* Helper class to hide subclass selects when not applicable (e.g. JHS 3) */
		.hidden-select { display: none !important; }
		.modal .modal-body .form-actions { display:flex; gap:0.5rem; justify-content:flex-start; margin-top:0.75rem; }
	</style>

		<style>
			/* Styles for the missing registers panel and modal footer actions */
			#missingRegistersPanel { position: fixed; right: 1rem; top: 4rem; z-index: 1200; width: 360px; background: #fff; border: 1px solid #e5e7eb; border-radius: 8px; box-shadow: 0 8px 24px rgba(16,24,40,0.12); padding: 0.6rem; }
			#missingRegistersPanel .mrp-body { max-height: 320px; overflow: auto; padding-top: 0.25rem; padding-bottom: 0.25rem; font-size: 0.98rem; color:#111; }
			#missingRegistersPanel .mrp-header { font-weight:700; font-size:0.98rem; }
			#missingRegistersPanel .mrp-header-row { display:flex; justify-content:space-between; align-items:center; margin-bottom:0.4rem; }
			#missingRegistersPanel .mrp-close-btn { background:none; border:0; font-size:1.05rem; cursor:pointer; }
			#missingRegistersPanel .mrp-footer { margin-top:0.5rem; text-align:right; }
			.modal-footer-actions { display:flex; gap:0.5rem; justify-content:flex-end; }
			.mrp-link { margin-left:0.4rem; color:#0b66b2; text-decoration:none; }
			.mrp-link:hover { text-decoration:underline; }
		</style>

		<style>
		  .gallery-bucket-hint { display:none; margin-top:0.5rem; }
		</style>
		<style>
		  /* Last Attendance tile helpers */
		  .last-att-row { display:flex; align-items:center; gap:0.5rem; }
		  .kpi-last-spinner { width:18px; height:18px; display:none; border-radius:50%; border:2px solid rgba(0,0,0,0.08); border-top-color: #0b66b2; animation: kpi-spin 800ms linear infinite; }
		  @keyframes kpi-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
		</style>

		<style>
		  /* Gallery modal styles */
		  .gallery-upload-row { display:flex; gap:0.75rem; align-items:flex-start; margin-bottom:0.75rem; }
		  .gallery-upload-left { flex:1; }
		  .gallery-upload-right { flex:2; display:flex; flex-direction:column; gap:0.4rem; }
		  .gallery-desc { width:100%; box-sizing:border-box; padding:0.45rem 0.6rem; border-radius:6px; border:1px solid #d1d5db; }
		  .gallery-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:0.6rem; margin-top:0.6rem; }
		  .gallery-thumb { background:#fff; border:1px solid #e6e6e6; border-radius:6px; overflow:hidden; display:flex; flex-direction:column; }
		  .gallery-thumb img { width:100%; height:120px; object-fit:cover; display:block; }
		  .gallery-thumb .meta { padding:0.45rem; font-size:0.92rem; }
		</style>

		<style>
		  /* Header slideshow styles */
		  .header-slideshow { position:relative; width:100%; max-width:980px; margin:0.6rem 0 0.8rem 0; border-radius:10px; overflow:hidden; box-shadow: 0 8px 30px rgba(16,24,40,0.06); background:#fff; display:none; }
		  .header-slideshow .hs-slides { position:relative; width:100%; height:140px; }
		  .header-slideshow .hs-slide { position:absolute; inset:0; opacity:0; transform:translateX(6%); transition:opacity .6s ease, transform .6s ease; display:flex; align-items:center; justify-content:center; }
		  .header-slideshow .hs-slide.active { opacity:1; transform:translateX(0); }
		  .header-slideshow .hs-slide img { width:100%; height:140px; object-fit:cover; display:block; }
		  .header-slideshow .hs-control { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.35); color:#fff; border:0; padding:0.4rem 0.6rem; border-radius:6px; cursor:pointer; z-index:30; }
		  .header-slideshow .hs-prev { left:0.6rem; }
		  .header-slideshow .hs-next { right:0.6rem; }
		  /* Small screens: reduce height */
		  @media (max-width:900px) { .header-slideshow .hs-slides, .header-slideshow .hs-slide img { height:96px; } }
		</style>

	<style>
	  /* Student Tiles Grid */
	  .student-tiles-section {
	    margin-top: 2rem;
	  }
	  
	  .student-tiles-grid {
	    display: grid;
	    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
	    gap: 1.5rem;
	    margin-top: 1rem;
	  }
	  
	  .student-tile {
	    background: #fff;
	    border-radius: 12px;
	    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
	    overflow: hidden;
	    transition: transform 0.2s, box-shadow 0.2s;
	    cursor: pointer;
	  }
	  
	  .student-tile:hover {
	    transform: translateY(-4px);
	    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
	  }
	  
	  .student-tile-header {
	    background: linear-gradient(135deg, #0ea5a4, #047857);
	    padding: 1rem;
	    text-align: center;
	  }
	  
	  .student-tile-image {
	    width: 100px;
	    height: 100px;
	    border-radius: 50%;
	    background: #e5e7eb;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    margin: 0 auto 0.5rem;
	    overflow: hidden;
	    border: 3px solid #fff;
	  }
	  
	  .student-tile-image img {
	    width: 100%;
	    height: 100%;
	    object-fit: cover;
	  }
	  
	  .student-tile-name {
	    font-weight: 700;
	    font-size: 1.1rem;
	    color: #fff;
	    margin: 0.5rem 0 0 0;
	  }
	  
	  .student-tile-content {
	    padding: 1.2rem;
	  }
	  
	  .student-detail {
	    display: flex;
	    justify-content: space-between;
	    align-items: center;
	    padding: 0.6rem 0;
	    border-bottom: 1px solid #f0f0f0;
	  }
	  
	  .student-detail:last-child {
	    border-bottom: none;
	  }
	  
	  .student-detail-label {
	    font-size: 0.85rem;
	    color: #666;
	    font-weight: 600;
	  }
	  
	  .student-detail-value {
	    font-size: 0.95rem;
	    color: #333;
	    font-weight: 500;
	    text-align: right;
	  }
	  
	  .student-tile-actions {
	    display: flex;
	    gap: 0.5rem;
	    margin-top: 1rem;
	    padding-top: 1rem;
	    border-top: 1px solid #f0f0f0;
	  }
	  
	  .student-tile-actions button {
	    flex: 1;
	    padding: 0.6rem;
	    font-size: 0.85rem;
	    border: none;
	    border-radius: 6px;
	    cursor: pointer;
	    transition: background 0.2s;
	  }
	  
	  .student-tile-actions .edit-btn {
	    background: #0ea5a4;
	    color: #fff;
	  }
	  
	  .student-tile-actions .edit-btn:hover {
	    background: #0d8a89;
	  }
	  
	  .student-tile-actions .delete-btn {
	    background: #f87171;
	    color: #fff;
	  }
	  
	  .student-tile-actions .delete-btn:hover {
	    background: #ef4444;
	  }
	  
	  @media (max-width: 900px) {
	    .student-tiles-grid {
	      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
	      gap: 1rem;
	    }
	    
	    .student-tile-header {
	      padding: 0.8rem;
	    }
	    
	    .student-tile-image {
	      width: 80px;
	      height: 80px;
	    }
	    
	    .student-tile-content {
	      padding: 1rem;
	    }
	    
	    .student-detail {
	      padding: 0.4rem 0;
	    }
	  }
	</style>

	<style>
	  /* Hide the large in-page management sections since these are now exposed via modal tiles */
	  .grid-sections > section#students,
	  .grid-sections > section#teachers,
	  .grid-sections > section#admins {
	    display: none !important;
	    visibility: hidden !important;
	    height: 0 !important;
	    margin: 0 !important;
	    padding: 0 !important;
	    overflow: hidden !important;
	  }
	</style>

	<!-- Breakdown animations (slideshow / pop) -->

</head>
<body>
	<main class="admin-app">
		<div class="admin-top">
			<div class="brand">
				<img src="Badge.png" alt="logo" class="logo" />
				<div>
					<h1>Nsuta B Portal ‚Äî Admin</h1>
					<p class="muted-small">Manage students, teachers and admins ‚Äî live tiles & quick actions</p>
				</div>
			</div>

	      <!-- Header slideshow: shows rotating gallery images in the top area -->
	      <div id="headerSlideshow" class="header-slideshow" aria-hidden="true">
	        <div class="hs-slides" id="hsSlides" aria-live="polite"></div>
	        <button class="hs-prev hs-control" id="hsPrev" aria-label="Previous slide">‚óÄ</button>
	        <button class="hs-next hs-control" id="hsNext" aria-label="Next slide">‚ñ∂</button>
	      </div>
			<div class="actions-right">
				<div class="quick-actions">
					<button id="btnAddStudent" class="action-btn">+ Student</button>
					<button id="btnAddTeacher" class="action-btn ml-sm">+ Teacher</button>
									<button id="btnAddAdmin" class="action-btn ml-sm btn-admin">+ Admin</button>
									<button id="btnCheckRegisters" class="action-btn ml-sm">Check Registers</button>
					<!-- Logout control for admin users -->
					<button id="btnLogout" class="action-btn ml-sm btn-logout">Logout</button>
				</div>
				<!-- Top tools removed per request: Announcement / Promotion / Events / School Dates -->
			</div>

			<!-- Missing Registers Panel (hidden by default) -->
			<div id="missingRegistersPanel" class="modal-panel hidden">
			  <div class="mrp-header-row">
			    <div class="mrp-header">Missing Registers</div>
			    <div><button id="mrpCloseBtn" class="mrp-close-btn">‚úï</button></div>
			  </div>
			  <div class="mrp-body"></div>
			  <div class="mrp-footer"></div>
			</div>

			<!-- Check Registers Modal -->
			<div id="checkRegistersModal" class="modal hidden" aria-hidden="true">
			  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="checkRegistersTitle">
			    <div class="modal-header">
			      <h3 id="checkRegistersTitle">Check Registers</h3>
			    </div>
			    <div class="modal-body">
						<div class="form-group">
							<label for="crTerm">Term</label>
							<select id="crTerm">
								<option value="">-- Select Term --</option>
								<option>1st Term</option>
								<option>2nd Term</option>
								<option>3rd Term</option>
							</select>
						</div>
			      <div class="form-group">
			        <label for="crDate">Date</label>
			        <input id="crDate" type="date" />
			      </div>
			    </div>
					<div class="modal-footer modal-footer-actions">
			      <button id="crCancel" class="action-btn">Cancel</button>
			      <button id="crRun" class="action-btn">Run Check</button>
			    </div>
			  </div>
			</div>
		</div>

		<section class="tiles-grid" aria-label="Quick KPI tiles">
			<!-- Students flip tile -->
			<div class="flip-card" id="tileStudents">
				<div class="flip-card-inner">
					<div class="flip-card-front tile tileAccent" data-action="section:students" role="button" tabindex="0">
						<div class="icon iconBlue">üë®‚Äçüéì</div>
						<div class="body">
							<div class="title">Students</div>
							<div id="kpiStudents" class="value">0</div>
							<div class="muted">Registered students</div>
						</div>
					</div>
					<div class="flip-card-back" data-action="section:students" aria-hidden="true">
						<div class="body">
							<div class="back-title">Manage Students</div>
							<div class="back-desc">Click here to view or manage registered students</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Teachers flip tile -->
			<div class="flip-card" id="tileTeachers">
				<div class="flip-card-inner">
					<div class="flip-card-front tile tileAccent" data-action="section:teachers" role="button" tabindex="0">
						<div class="icon iconGreen">üë©‚Äçüè´</div>
						<div class="body">
							<div class="title">Teachers</div>
							<div id="kpiTeachers" class="value">0</div>
							<div class="muted">Registered teachers</div>
						</div>
					</div>
					<div class="flip-card-back" data-action="section:teachers" aria-hidden="true">
						<div class="body">
							<div class="back-title">Manage Teachers</div>
							<div class="back-desc">Click here to view or manage registered teachers</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Admins flip tile -->
			<div class="flip-card" id="tileAdmins">
				<div class="flip-card-inner">
					<div class="flip-card-front tile tileAccent" data-action="section:admins" role="button" tabindex="0">
						<div class="icon iconOrange">üõ°Ô∏è</div>
						<div class="body">
							<div class="title">Admin Accounts</div>
							<div id="kpiAdmins" class="value">0</div>
							<div class="muted">Active admin users</div>
						</div>
					</div>
					<div class="flip-card-back" data-action="section:admins" aria-hidden="true">
						<div class="body">
							<div class="back-title">Manage Admins</div>
							<div class="back-desc">Click here to view or manage admin accounts</div>
						</div>
					</div>
				</div>
			</div>

			<div class="tile tile-centered"> 
				<div class="body text-center">
					<div class="title">Quick Export</div>
					<div class="mt-sm"><button id="exportStudentsBtn" class="action-btn">Export Students</button></div>
					<div class="mt-sm"><label for="csvInputMain" class="muted-small">Import CSV</label><input id="csvInputMain" type="file" accept=".csv" aria-label="Import students CSV" /></div>
				</div>
			</div>

			<!-- Top Students flip tile (JHS 1 & 2 overall best performers) -->
			<div class="flip-card" id="tileTopStudents">
				<div class="flip-card-inner">
					<div class="flip-card-front tile tileAccent" data-action="modal:topStudentsModal" role="button" tabindex="0">
						<div class="icon">üèÖ</div>
						<div class="body">
							<div class="title">Top Students</div>
							<div id="kpiTopStudents" class="value">‚Äî</div>
							<div class="muted">Best performers (JHS 1 & 2)</div>
						</div>
					</div>
					<div class="flip-card-back" data-action="modal:topStudentsModal" aria-hidden="true">
						<div class="body">
							<div class="back-title">Top Students (JHS1 & JHS2)</div>
							<div class="back-desc">Click to view detailed scores and rankings</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Class Ranking flip tile -->
			<div class="flip-card" id="tileClassRanking">
				<div class="flip-card-inner">
					<div class="flip-card-front tile tileAccent" data-action="modal:classRankingModal" role="button" tabindex="0">
						<div class="icon">üìã</div>
						<div class="body">
							<div class="title">Class Ranking</div>
							<div id="kpiClassRanking" class="value">‚Äî</div>
							<div class="muted">Generate ranking PDF per class</div>
						</div>
					</div>
					<div class="flip-card-back" data-action="modal:classRankingModal" aria-hidden="true">
						<div class="body">
							<div class="back-title">Class Ranking</div>
							<div class="back-desc">Click to select a class and export its ranking as PDF</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Dashboard Overview Cards (live tiles) -->
		<div id="dashboardOverviewCards" class="dashboard-cards" aria-label="Overview tiles">
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-modal="schoolDatesModal">
			      <div class="card-icon">üìÜ</div>
			      <div class="card-body"><div class="card-title">Set School Dates</div><div class="card-desc">Vacation & Reopening</div></div>
			    </div>
			    <div class="flip-card-back" data-action="modal:schoolDatesModal" aria-hidden="true">
			      <div class="body"><div class="back-title">Set School Dates</div><div class="back-desc">Open the school dates editor</div></div>
			    </div>
			  </div>
			</div>

			<!-- Last Attendance tile: shows the teacher who last submitted attendance -->
			<div class="flip-card" id="tileLastAttendance">
				<div class="flip-card-inner">
					<div class="flip-card-front dashboard-card" tabindex="0" role="button" aria-label="Last Attendance">
						<div class="card-icon">‚úÖ</div>
						<div class="card-body"><div class="card-title">Last Attendance</div>
							<div class="last-att-row">
							  <div id="kpiLastAttendance" class="value">‚Äî</div>
							  <div id="kpiLastAttendanceSpinner" aria-hidden="true" class="kpi-last-spinner"></div>
							</div>
							<div id="kpiLastAttendanceDate" class="muted-small">‚Äî</div>
						</div>
					</div>
					<div class="flip-card-back" aria-hidden="true">
						<div class="body"><div class="back-title">Last Attendance</div><div class="back-desc">Shows the teacher who most recently submitted a register</div></div>
					</div>
				</div>
			</div>

			<!-- Gallery tile: shows recent school pictures & activities -->
			<div class="flip-card" id="tileGallery">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" role="button" aria-label="Gallery">
			      <div class="card-icon">üñºÔ∏è</div>
			      <div class="card-body"><div class="card-title">School Gallery</div>
			        <div id="kpiGalleryPreview" class="value">‚Äî</div>
			        <div id="kpiGalleryCount" class="muted-small">‚Äî</div>
			      </div>
			    </div>
			    <div class="flip-card-back" aria-hidden="true">
			      <div class="body"><div class="back-title">School Gallery</div><div class="back-desc">Upload and view recent pictures and activities</div></div>
			    </div>
			  </div>
			</div>

			<!-- Student List Tile -->
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" role="button" aria-label="Student List" onclick="window.location.href='student-list.html'">
			      <div class="card-icon">üë•</div>
			      <div class="card-body"><div class="card-title">Student Directory</div><div class="card-desc">View all students</div></div>
			    </div>
			    <div class="flip-card-back" aria-hidden="true">
			      <div class="body"><div class="back-title">Student Directory</div><div class="back-desc">Browse and manage all registered students</div></div>
			    </div>
			  </div>
			</div>

			<!-- Missing Marks Tile -->
			<div class="flip-card" id="tileMissingMarks">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-modal="missingMarksModal">
			      <div class="card-icon">‚ö†Ô∏è</div>
			      <div class="card-body"><div class="card-title">Missing Marks</div>
			        <div id="kpiMissingMarks" class="value">‚Äî</div>
			        <div id="kpiMissingMarksDesc" class="muted-small">Students with incomplete marks</div>
			      </div>
			    </div>
			    <div class="flip-card-back" data-action="modal:missingMarksModal" aria-hidden="true">
			      <div class="body"><div class="back-title">Missing Marks</div><div class="back-desc">Check students with missing SBA or exam marks</div></div>
			    </div>
			  </div>
			</div>

			<!-- Teacher Submissions Tile -->
			<div class="flip-card" id="tileTeacherSubmissions">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-modal="teacherSubmissionsModal">
			      <div class="card-icon">‚úÖ</div>
			      <div class="card-body"><div class="card-title">Teacher Submissions</div>
			        <div id="kpiTeacherSubmissions" class="value">‚Äî</div>
			        <div id="kpiTeacherSubmissionsDesc" class="muted-small">Teachers who submitted marks</div>
			      </div>
			    </div>
			    <div class="flip-card-back" data-action="modal:teacherSubmissionsModal" aria-hidden="true">
			      <div class="body"><div class="back-title">Teacher Submissions</div><div class="back-desc">View teachers who have submitted exam and SBA marks</div></div>
			    </div>
			  </div>
			</div>

			<!-- Gallery Modal -->
			<div id="galleryModal" class="modal hidden">
			  <div class="modal-content">
			    <div class="modal-header"><h3>School Gallery</h3></div>
				  <div class="modal-body">
				      <div class="gallery-upload-row">
				        <div class="gallery-upload-left">
						  <label for="galleryFile">Picture(s)</label>
						  <input type="file" id="galleryFile" accept="image/*" multiple />
				        </div>
				        <div class="gallery-upload-right">
				          <label for="galleryTitle">Title</label>
				          <input type="text" id="galleryTitle" placeholder="Short title" />
				          <label for="galleryDesc">Description</label>
				          <textarea id="galleryDesc" rows="2" placeholder="Short description" class="gallery-desc"></textarea>
				        </div>
				      </div>
			      <div class="form-actions"><button id="galleryUploadBtn" class="action-btn">Upload</button> <button type="button" class="modal-close action-btn">Close</button></div>
				<div id="galleryBucketHint" class="muted-small gallery-bucket-hint"></div>
				<hr />
			      <div id="galleryGrid" class="gallery-grid">
			        <!-- Gallery thumbnails injected here -->
			      </div>
			    </div>
			  </div>
			</div>

			<!-- Last Attendance Modal -->
			<div id="lastAttendanceModal" class="modal hidden">
			  <div class="modal-content">
			    <div class="modal-header"><h3>Recent Attendance Submissions</h3></div>
			    <div class="modal-body">
			      <div id="lastAttendanceList" class="muted-small">Loading‚Ä¶</div>
			      <div class="form-actions"><button type="button" class="modal-close action-btn">Close</button></div>
			    </div>
			  </div>
			</div>

			<!-- Missing Marks Modal -->
			<div id="missingMarksModal" class="modal hidden">
			  <div class="modal-content">
			    <div class="modal-header"><h3>Students with Missing Marks</h3></div>
			    <div class="modal-body">
			      <div class="form-group">
			        <label for="missingMarksClass">Select Class:</label>
			        <select id="missingMarksClass">
			          <option value="">-- All Classes --</option>
			          <option>JHS 1</option>
			          <option>JHS 2</option>
			          <option>JHS 3</option>
			        </select>
			      </div>
			      <div class="form-group">
			        <label for="missingMarksTerm">Select Term:</label>
			        <select id="missingMarksTerm">
			          <option value="">-- Select Term --</option>
			          <option>1st Term</option>
			          <option>2nd Term</option>
			          <option>3rd Term</option>
			        </select>
			      </div>
			      <div class="form-group">
			        <label for="missingMarksYear">Select Year:</label>
			        <input type="number" id="missingMarksYear" placeholder="2025" min="2020" max="2030" />
			      </div>
			      <div class="form-actions">
			        <button id="checkMissingMarksBtn" class="action-btn">Check Missing Marks</button>
			        <button type="button" class="modal-close action-btn">Close</button>
			      </div>
			      <hr />
			      <div id="missingMarksResults" class="table-scroll">
			        <!-- Results will be displayed here -->
			      </div>
			    </div>
			  </div>
			</div>

			<!-- Teacher Submissions Modal -->
			<div id="teacherSubmissionsModal" class="modal hidden">
			  <div class="modal-content">
			    <div class="modal-header"><h3>Teachers Who Submitted Marks</h3></div>
			    <div class="modal-body">
			      <div class="form-group">
			        <label for="teacherSubmissionsClass">Select Class:</label>
			        <select id="teacherSubmissionsClass">
			          <option value="">-- All Classes --</option>
			          <option>JHS 1</option>
			          <option>JHS 2</option>
			          <option>JHS 3</option>
			        </select>
			      </div>
			      <div class="form-group">
			        <label for="teacherSubmissionsTerm">Select Term:</label>
			        <select id="teacherSubmissionsTerm">
			          <option value="">-- Select Term --</option>
			          <option>1st Term</option>
			          <option>2nd Term</option>
			          <option>3rd Term</option>
			        </select>
			      </div>
			      <div class="form-group">
			        <label for="teacherSubmissionsYear">Select Year:</label>
			        <input type="number" id="teacherSubmissionsYear" placeholder="2025" min="2020" max="2030" />
			      </div>
			      <div class="form-actions">
			        <button id="checkTeacherSubmissionsBtn" class="action-btn">Check Teacher Submissions</button>
			        <button type="button" class="modal-close action-btn">Close</button>
			      </div>
			      <hr />
			      <div id="teacherSubmissionsResults" class="table-scroll">
			        <!-- Results will be displayed here -->
			      </div>
			    </div>
			  </div>
			</div>

			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-modal="eventsModal">
			      <div class="card-icon">üìÖ</div>
			      <div class="card-body"><div class="card-title">Add School Event</div><div class="card-desc">Create calendar events</div></div>
			    </div>
			    <div class="flip-card-back" data-action="modal:eventsModal" aria-hidden="true">
			      <div class="body"><div class="back-title">Add School Event</div><div class="back-desc">Create and manage calendar events</div></div>
			    </div>
			  </div>
			</div>
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-modal="announcementModal">
			      <div class="card-icon">üì¢</div>
			      <div class="card-body"><div class="card-title">Site Announcement</div><div class="card-desc">Post site-wide notices</div></div>
			    </div>
			    <div class="flip-card-back" data-action="modal:announcementModal" aria-hidden="true">
			      <div class="body"><div class="back-title">Site Announcement</div><div class="back-desc">Write a short announcement for the homepage</div></div>
			    </div>
			  </div>
			</div>
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-modal="promotionPassMarkModal">
			      <div class="card-icon">üèÜ</div>
			      <div class="card-body"><div class="card-title">Promotion Pass</div><div class="card-desc">Set promotion pass mark</div></div>
			    </div>
			    <div class="flip-card-back" data-action="modal:promotionPassMarkModal" aria-hidden="true">
			      <div class="body"><div class="back-title">Promotion Pass</div><div class="back-desc">Adjust pass mark used for report cards</div></div>
			    </div>
			  </div>
			</div>
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-action="link:report.html">
			      <div class="card-icon">üìà</div>
			      <div class="card-body"><div class="card-title">Reports</div><div class="card-desc">View reports dashboard</div></div>
			    </div>
			    <div class="flip-card-back" data-action="link:report.html" aria-hidden="true">
			      <div class="body"><div class="back-title">Reports</div><div class="back-desc">Open the reports dashboard</div></div>
			    </div>
			  </div>
			</div>
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-action="section:studentBreakdown">
			      <div class="card-icon">üèñÔ∏è</div>
			      <div class="card-body"><div class="card-title">Public Holidays</div><div class="card-desc">Upcoming holidays</div></div>
			    </div>
			    <div class="flip-card-back" data-action="section:studentBreakdown" aria-hidden="true">
			      <div class="body"><div class="back-title">Public Holidays</div><div class="back-desc">View upcoming public holidays</div></div>
			    </div>
			  </div>
			</div>
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-action="section:interestConduct">
			      <div class="card-icon">‚≠ê</div>
			      <div class="card-body"><div class="card-title">Interest & Conduct</div><div class="card-desc">Manage interests & conduct</div></div>
			    </div>
			    <div class="flip-card-back" data-action="section:interestConduct" aria-hidden="true">
			      <div class="body"><div class="back-title">Interest & Conduct</div><div class="back-desc">Update student interests and conduct records</div></div>
			    </div>
			  </div>
			</div>
			<div class="flip-card">
			  <div class="flip-card-inner">
			    <div class="flip-card-front dashboard-card" tabindex="0" data-action="section:interestUpdate">
			      <div class="card-icon">üîÑ</div>
			      <div class="card-body"><div class="card-title">Interest Update</div><div class="card-desc">Update student interests</div></div>
			    </div>
			    <div class="flip-card-back" data-action="section:interestUpdate" aria-hidden="true">
			      <div class="body"><div class="back-title">Interest Update</div><div class="back-desc">Quickly update student interest statuses</div></div>
			    </div>
			  </div>
			</div>
		</div>

		<!-- Overview breakdowns: concise summaries of registered entities -->
		<div id="overviewBreakdowns" class="dashboard-cards">
		  <div class="dashboard-card small">
		    <div class="card-icon">üë®‚Äçüéì</div>
		    <div class="card-body"><div class="card-title">Students (by class)</div><div id="studentsBreakdown" class="muted-small">Loading‚Ä¶</div></div>
		  </div>
		  <div class="dashboard-card small">
		    <div class="card-icon">üë©‚Äçüè´</div>
		    <div class="card-body"><div class="card-title">Teachers (by role)</div><div id="teachersBreakdown" class="muted-small">Loading‚Ä¶</div></div>
		  </div>
		  <div class="dashboard-card small">
		    <div class="card-icon">üõ°Ô∏è</div>
		    <div class="card-body"><div class="card-title">Admins</div><div id="adminsBreakdown" class="muted-small">Loading‚Ä¶</div></div>
		  </div>
		</div>

			<div class="grid-sections">
				<section id="students" class="dashboard-section">
					<div class="section-card">
						<h2>Students</h2>
						<p class="muted-small">Add and manage student records. Import CSVs (first row headers accepted).</p>
						<div class="filters filters--start">
							<label for="classFilter">Class:</label>
							<select id="classFilter">
								<option value="">-- All Classes --</option>
								<option value="JHS 1">JHS 1</option>
								<option value="JHS 2">JHS 2</option>
								<option value="JHS 3">JHS 3</option>
							</select>
							<label for="studentSearch">Search:</label>
							<input id="studentSearch" type="text" placeholder="Search students..." />
							<label for="studentSelect">Select:</label>
							<select id="studentSelect"><option value="">-- Select Student --</option></select>
							<button class="action-btn ml-sm" onclick="exportStudentsCSV()">Export Students</button>
												</div>
												<div class="mobile-list-toggle" aria-hidden="false">
													<button class="action-btn" data-action="section:students">Open Students List</button>
												</div>
												<div class="table-scroll">
						<table id="studentTable" class="list-table" aria-label="Students">
							<thead>
								<tr><th>Picture</th><th>Name</th><th>Area</th><th>DOB</th><th>NHIS</th><th>Gender</th><th>Class</th><th>Parent</th><th>Contact</th><th>Username</th><th>PIN</th><th>Actions</th></tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						</div>
						<!-- Student Tiles View -->
						<div class="student-tiles-section">
							<h3>Student Profiles</h3>
							<div id="studentTilesContainer" class="student-tiles-grid"></div>
						</div>
					</div>
				</section>

				<section id="teachers" class="dashboard-section">
					<div class="section-card section-card--spaced">
						<h2>Teachers</h2>
						<p class="muted-small">Teachers list ‚Äî assign classes & subjects in the teacher form.</p>
						<div class="filters filters--start">
							<label for="teacherSelect">Select Teacher:</label>
							<select id="teacherSelect"><option value="">-- Select Teacher --</option></select>
							<button class="action-btn ml-sm" onclick="exportTeachersCSV()">Export Teachers</button>
						</div>
						<div class="mobile-list-toggle">
						  <button class="action-btn" data-action="section:teachers">Open Teachers List</button>
						</div>
						<div class="table-scroll">
						<table id="teacherTable" class="list-table" aria-label="Teachers">
							<thead><tr><th>Name</th><th>Gender</th><th>DOB</th><th>StaffID</th><th>NTC</th><th>Reg#</th><th>SSNIT</th><th>GhanaCard</th><th>Contact</th><th>Rank</th><th>Qualification</th><th>Classes</th><th>Subjects</th><th>PIN</th><th>Actions</th></tr></thead>
							<tbody></tbody>
						</table>
						</div>
					</div>
				</section>

				<section id="admins" class="dashboard-section">
					<div class="section-card section-card--spaced">
						<h2>Admins</h2>
						<p class="muted-small">Admin accounts with access to the portal.</p>
						<div class="filters filters--start">
							<button class="action-btn ml-sm" onclick="exportAdminsCSV()">Export Admins</button>
						</div>
						<div class="mobile-list-toggle">
						  <button class="action-btn" data-action="section:admins">Open Admins List</button>
						</div>
						<div class="table-scroll">
						<table id="adminTable" class="list-table" aria-label="Admins">
							<thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>PIN</th><th>Actions</th></tr></thead>
							<tbody></tbody>
						</table>
						</div>
					</div>
				</section>

			<aside>
				<div class="section-card">
					<h2>Activity</h2>
					<div id="recentActivity" class="muted-small">No recent actions. Use the buttons above to start adding records.</div>
				</div>

				<div class="section-card section-card--spaced">
					<h2>Exports & Imports</h2>
					<p class="muted-small">Export the current lists or import students by CSV using the upload control above.</p>
					<div class="flex-row mt-sm"><button id="exportTeachersBtn" class="action-btn">Export Teachers</button><button id="exportAdminsBtn" class="action-btn">Export Admins</button></div>
				</div>
			</aside>
		</div>

		<!-- Student Modal (sample-derived) -->
		<div id="studentModal" class="modal hidden">
			<div class="modal-content">
				<div class="modal-header"><h3>Register Student</h3></div>
				<div class="modal-body">
					<form id="studentForm" enctype="multipart/form-data" novalidate>
						<div class="form-group">
							<label for="register_id">Student ID</label>
							<input type="text" name="register_id" id="register_id" placeholder="Auto-assigned" readonly class="input-readonly" />
							<input type="hidden" name="student_id" />
						</div>
						<div class="form-group">
							<label for="student_dob">Date of Birth</label>
							<input type="date" id="student_dob" name="dob" required />
						</div>
						<div class="form-group">
							<label for="nhis_number">NHIS Number</label>
							<input type="text" id="nhis_number" name="nhis_number" placeholder="NHIS Number" />
						</div>
						<div class="form-group">
							<label for="first_name">First Name</label>
							<input type="text" id="first_name" name="first_name" placeholder="First Name" required />
						</div>
						<div class="form-group">
							<label for="surname">Surname</label>
							<input type="text" id="surname" name="surname" placeholder="Surname" required />
						</div>
						<div class="form-group">
							<label for="area">Area</label>
							<input type="text" id="area" name="area" placeholder="Area" />
						</div>
						<div class="form-group">
							<label for="gender">Gender</label>
							<select name="gender" id="gender" title="Gender">
								<option value="">Select Gender</option>
								<option value="Male">Male</option>
								<option value="Female">Female</option>
							</select>
						</div>
						<div class="form-group">
							<label>Class</label>
							<div class="class-select-row">
								<select name="main_class_select" id="student_main_class_select" title="Main Class">
									<option value="">Select Class</option>
									<option value="JHS 1">JHS 1</option>
									<option value="JHS 2">JHS 2</option>
									<option value="JHS 3">JHS 3</option>
								</select>
								<select name="sub_class_select" id="student_sub_class_select" class="hidden-select" title="Subclass">
									<option value="">Select Subclass</option>
									<option value="A">A</option>
									<option value="B">B</option>
								</select>
								<input type="hidden" name="class" id="student_class_hidden" />
							</div>
						</div>
						<div class="form-group">
							<label for="parent_name">Parent/Guardian Name</label>
							<input type="text" id="parent_name" name="parent_name" placeholder="Parent/Guardian Name" />
						</div>
						<div class="form-group">
							<label for="parent_contact">Parent/Guardian Contact</label>
							<input type="tel" id="parent_contact" name="parent_contact" placeholder="Parent/Guardian Number" />
						</div>
						<div class="form-group">
							<label for="picture">Picture</label>
							<input type="file" id="picture" name="picture" accept="image/*" title="Upload Picture" />
						</div>
						<div class="form-actions">
							<button type="button" id="studentSaveBtn">Save</button>
							<button type="button" onclick="closeModal('studentModal')">Cancel</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Teacher Modal (sample-derived) -->
		<div id="teacherModal" class="modal hidden">
			<div class="modal-content">
				<div class="modal-header"><h3>Register Teacher</h3></div>
				<div class="modal-body">
					<form id="teacherForm">
						<input type="hidden" name="teacher_id" />
						<div class="modal-form-grid">
							<div class="form-group">
								<label for="teacher_name">Full Name</label>
								<input type="text" id="teacher_name" name="name" placeholder="Full Name" required />
							</div>
							<div class="form-group">
								<label for="teacher_gender">Gender</label>
								<select name="gender" id="teacher_gender" title="Gender">
									<option value="">Select Gender</option>
									<option value="Male">Male</option>
									<option value="Female">Female</option>
								</select>
							</div>
							<div class="form-group">
								<label for="dob">Date of Birth</label>
								<input type="date" id="dob" name="dob" />
							</div>
							<div class="form-group">
								<label for="staff_id">Staff ID</label>
								<input type="text" id="staff_id" name="staff_id" placeholder="Staff ID" />
							</div>
							<div class="form-group">
								<label for="ntc">NTC Number</label>
								<input type="text" id="ntc" name="ntc" placeholder="NTC Number" />
							</div>
							<div class="form-group">
								<label for="registered_number">Registered Number</label>
								<input type="text" id="registered_number" name="registered_number" placeholder="Registered Number" />
							</div>
							<div class="form-group">
								<label for="ssnit">SSNIT Number</label>
								<input type="text" id="ssnit" name="ssnit" placeholder="SSNIT Number" />
							</div>
							<div class="form-group">
								<label for="ghana_card">Ghana Card Number</label>
								<input type="text" id="ghana_card" name="ghana_card" placeholder="Ghana Card Number" />
							</div>
							<div class="form-group">
								<label for="contact">Contact Number</label>
								<input type="tel" id="contact" name="contact" placeholder="Contact Number" />
							</div>
							<div class="form-group">
								<label for="rank">Rank</label>
								<input type="text" id="rank" name="rank" placeholder="Rank" />
							</div>
							<div class="form-group">
								<label for="qualification">Highest Academic Qualification</label>
								<input type="text" id="qualification" name="qualification" placeholder="Highest Academic Qualification" />
							</div>
							<div class="form-group full-width"><label>Class-Subject Assignments</label></div>
							<div class="form-group full-width"><div id="assignmentRowsContainer"></div></div>
							<div class="form-group full-width"><button type="button" id="addAssignmentRowBtn">Add Class-Subject Pair</button></div>
						</div>
						<!-- Responsibility and Class Teacher Section -->
								<div class="form-group full-width">
									<label for="responsibility">Responsibility</label>
									<select name="responsibility" id="responsibility" title="Responsibility">
								<option value="">Select Responsibility</option>
								<option value="Class Teacher">Class Teacher</option>
								<option value="Headteacher">Headteacher</option>
								<option value="Assistant Headteacher">Assistant Headteacher</option>
								<option value="Subject Teacher">Subject Teacher</option>
								<option value="Career Tech Teacher">Career Tech Teacher</option>
								<option value="Other">Other</option>
							</select>
						</div>
						<div class="form-group full-width" id="classTeacherSection">
							<label for="main_class_select">Class Responsible For</label>
							<div class="class-select-group">
								<select name="main_class_select" id="main_class_select" class="form-inline-select" title="Main Class">
									<option value="">Select Main Class</option>
									<option value="JHS 1">JHS 1</option>
									<option value="JHS 2">JHS 2</option>
									<option value="JHS 3">JHS 3</option>
								</select>
								<select name="sub_class_select" id="sub_class_select" class="hidden-select" title="Subclass">
									<option value="">Select Subclass</option>
									<option value="A">A</option>
									<option value="B">B</option>
								</select>
							</div>
							<input type="hidden" name="class_teacher_class" id="class_teacher_class" />
							<!-- New split fields: main class and subclass (kept alongside legacy field for backwards compatibility) -->
							<input type="hidden" name="class_teacher_class_main" id="class_teacher_class_main" />
							<!-- Subclass column in DB is named `class_teacher_subclass` -->
							<input type="hidden" name="class_teacher_subclass" id="class_teacher_subclass" />
						</div>
						<!-- Extended HR fields -->
						<div class="form-group">
							<label for="first_appointment_date">First Appointment Date</label>
							<input type="date" id="first_appointment_date" name="first_appointment_date" />
						</div>
						<div class="form-group">
							<label for="year_posted_station">Year Posted to Current Station</label>
							<input type="number" id="year_posted_station" name="year_posted_station" min="1900" max="2099" />
						</div>
						<div class="form-group">
							<label for="years_at_present_school">Years at Present Station or School</label>
							<input type="number" id="years_at_present_school" name="years_at_present_school" min="1" readonly />
						</div>
						<div class="form-group">
							<label for="date_promoted_last_rank">Date Promoted to Last Rank</label>
							<input type="date" id="date_promoted_last_rank" name="date_promoted_last_rank" />
						</div>
						<div class="form-group">
							<label for="date_placed_on_rank">Date Placed on Rank</label>
							<input type="date" id="date_placed_on_rank" name="date_placed_on_rank" />
						</div>
						<div class="form-group">
							<label for="salary_level">Salary Level</label>
							<input type="text" id="salary_level" name="salary_level" placeholder="Salary Level" />
						</div>
						<div class="form-group">
							<label for="bank">Bank</label>
							<input type="text" id="bank" name="bank" placeholder="Bank" />
						</div>
						<div class="form-group">
							<label for="bank_branch">Bank Branch</label>
							<input type="text" id="bank_branch" name="bank_branch" placeholder="Bank Branch" />
						</div>
						<div class="form-group">
							<label for="bank_account_number">Bank Account Number</label>
							<input type="text" id="bank_account_number" name="bank_account_number" placeholder="Bank Account Number" />
						</div>
						<div class="form-group">
							<label for="highest_professional_qualification">Highest Professional Qualification</label>
							<input type="text" id="highest_professional_qualification" name="highest_professional_qualification" placeholder="Highest Professional Qualification" />
						</div>
						<div class="form-group">
							<label for="professional_qualification_date">Professional Qualification Date Completed</label>
							<input type="date" id="professional_qualification_date" name="professional_qualification_date" />
						</div>
						<div class="form-group">
							<label for="last_promotion_date">Date of Last Promotion</label>
							<input type="date" id="last_promotion_date" name="last_promotion_date" />
						</div>
						<div class="form-group">
							<label for="previous_station">Previous Station</label>
							<input type="text" id="previous_station" name="previous_station" placeholder="Previous Station" />
						</div>
						<div class="form-group">
							<label for="due_for_promotion">Due For Promotion to Grade</label>
							<input type="text" id="due_for_promotion" name="due_for_promotion" placeholder="Due For Promotion to Grade" />
						</div>
						<div class="form-group">
							<label for="denomination">Denomination</label>
							<select name="denomination" id="denomination" title="Denomination"></select>
						</div>
						<div class="form-group">
							<label for="home_town">Home Town</label>
							<input type="text" id="home_town" name="home_town" placeholder="Home Town" />
						</div>
						<div class="form-actions">
							<button type="submit">Save</button>
							<button type="button" onclick="closeModal('teacherModal')">Cancel</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Admin Modal (sample-derived) -->
		<div id="adminModal" class="modal hidden">
			<div class="modal-content">
				<div class="modal-header"><h3>Register Admin</h3></div>
				<div class="modal-body">
					<form id="adminForm">
						<input type="hidden" name="admin_id" />
						<div class="form-group">
							<label for="admin_full_name">Full name</label>
							<input type="text" id="admin_full_name" name="full_name" placeholder="Full name" required />
						</div>
						<div class="form-group">
							<label for="admin_email">Email</label>
							<input type="email" id="admin_email" name="email" placeholder="Email" required />
						</div>
						<div class="form-group">
							<label for="admin_phone">Phone</label>
							<input type="tel" id="admin_phone" name="phone" placeholder="Phone" />
						</div>
						<div class="form-group">
							<label for="admin_pin">PIN</label>
							<input type="text" id="admin_pin" name="pin" placeholder="PIN (4-6 digits)" />
						</div>
						<div class="form-actions">
							<button type="submit">Save</button>
							<button type="button" onclick="closeModal('adminModal')">Cancel</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Promotion Pass Mark Modal (from sample.html) -->
		<div id="promotionPassMarkModal" class="modal hidden">
			<div class="modal-content">
				<h3>Report Card Promotion Pass Mark</h3>
				<p class="section-desc">Set the total marks required for promotion on the report card (used for annual promotion, not promotion exam).</p>
				<form id="promotionPassMarkForm">
					<label for="promotionPassMarkInput">Promotion Pass Mark:</label>
					<input id="promotionPassMarkInput" type="number" min="0" max="10000" step="1" class="promotion-passmark-input" required />
					<div class="form-actions"><button type="submit">Save</button><span id="promotionPassMarkStatus" class="promotion-passmark-status"></span></div>
				</form>
				<button type="button" onclick="closeModal('promotionPassMarkModal')">Back to Dashboard</button>
			</div>
		</div>

		<!-- School Dates Modal (from sample.html) -->
		<div id="schoolDatesModal" class="modal hidden">
			<div class="modal-content">
				<h3>Set School Dates</h3>
				<form id="schoolDatesForm">
					<label for="vacation_date">Vacation Date</label>
					<input type="date" id="vacation_date" name="vacation_date" required />
					<label for="reopen_date">Reopening Date</label>
					<input type="date" id="reopen_date" name="reopen_date" required />
					<label for="attendance_total_days">Actual Attendance Days (Out of)</label>
					<input type="number" id="attendance_total_days" name="attendance_total_days" min="1" required placeholder="e.g. 45" />
					<div class="form-actions"><button type="submit">Save</button><button type="button" onclick="closeModal('schoolDatesModal')">Cancel</button></div>
				</form>
			</div>
		</div>

		<!-- Announcement Modal (from sample.html) -->
		<div id="announcementModal" class="modal hidden">
			<div class="modal-content">
				<h3>Site Announcement</h3>
				<p class="section-desc">Set the short announcement that appears on the homepage (keeps HTML stripped).</p>
				<form id="announcementForm">
					<label for="announcementText">Announcement (short)</label>
					<textarea id="announcementText" name="announcement" rows="4" class="announcement-textarea"></textarea>
					<div class="announcement-controls"><span id="announcementStatus" class="announcement-status"></span><button type="submit" class="btn btn-primary">Save</button><button type="button" class="btn btn-ghost" onclick="closeModal('announcementModal')">Cancel</button></div>
				</form>
			</div>
		</div>

		<!-- Events Modal (from sample.html) -->
		<div id="eventsModal" class="modal hidden">
			<div class="modal-content">
				<h3>Add School Event</h3>
				<form id="eventsForm">
					<label for="event_date">Event Date</label>
					<input type="date" id="event_date" name="event_date" required />
					<label for="event_title">Title</label>
					<input type="text" id="event_title" name="event_title" placeholder="Event Title" required />
					<label for="event_desc">Description</label>
					<textarea id="event_desc" name="event_desc" placeholder="Event Description" required></textarea>
					<div class="form-actions"><button type="submit">Save</button><button type="button" onclick="closeModal('eventsModal')">Cancel</button></div>
				</form>
			</div>
		</div>

		<!-- Invisible backdrop (managed by JS) -->

			<!-- Section modal: used to display a full dashboard section in an overlay when a live tile is clicked -->
			<div id="sectionModal" class="modal hidden" aria-hidden="true">
			  <div class="modal-content">
					<div class="section-header">
						<h3 id="sectionModalTitle">Section</h3>
						<button class="modal-close action-btn">Close</button>
					</div>
			    <div id="sectionModalBody"></div>
			  </div>
			</div>

		<!-- Top Students Modal -->
		<div id="topStudentsModal" class="modal hidden">
		  <div class="modal-content">
			<div class="modal-header"><h3>Top Students ‚Äî JHS 1 & 2</h3></div>
			<div class="modal-body">
				<div id="topStudentsContent" class="muted-small">Loading top students‚Ä¶</div>
				<div class="form-actions"><button type="button" class="modal-close action-btn">Close</button></div>
			</div>
		  </div>
		</div>

		<!-- Class Ranking Modal -->
		<div id="classRankingModal" class="modal hidden">
		  <div class="modal-content">
			<div class="modal-header"><h3>Class Ranking ‚Äî Generate PDF</h3></div>
			<div class="modal-body">
				<div class="form-group">
					<label for="rankingClassSelect">Class</label>
					<select id="rankingClassSelect"><option value="">-- Select Class --</option></select>
				</div>
				<div class="form-group" id="rankingSubclassWrapper">
					<label for="rankingSubclassSelect">Subclass (optional)</label>
					<select id="rankingSubclassSelect" class="hidden-select"><option value="">-- All Subclasses --</option></select>
				</div>
				<div class="form-group">
					<label for="rankingTermSelect">Term</label>
					<select id="rankingTermSelect"><option value="">-- Select Term --</option><option value="1st Term">1st Term</option><option value="2nd Term">2nd Term</option><option value="3rd Term">3rd Term</option></select>
				</div>
				<div class="form-group">
					<label for="rankingYearInput">Academic Year</label>
					<input id="rankingYearInput" placeholder="e.g. 2025/2026" />
				</div>
				<div id="classRankingPreview" class="muted-small">Select class, term and year then click Generate.</div>
				<div class="form-actions"><button id="generateClassRankingBtn" class="action-btn">Generate PDF</button> <button type="button" class="modal-close action-btn">Close</button></div>
			</div>
		  </div>
		</div>

		<div id="modalBackdrop" class="modal-backdrop" aria-hidden="true"></div>

	</main>

		<!-- Supabase client (UMD) - required by dashboard.js which expects `supabase` global -->
		<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
		<!-- Core dashboard logic (creates supabaseClient and provides loadStudents/loadTeachers/loadAdmins) -->
		<script src="dashboard.js"></script>
		<!-- Admin-specific behavior and form handlers (uses supabaseClient created in dashboard.js) -->
		<script src="admin.js"></script>
		<!-- Small admin inline helpers (assignment rows, dashboard-card actions) -->
		<script src="admin-inline.js"></script>
		<!-- Notifications, toasts, confirm/prompt helpers -->
		<script src="toasts.js"></script>
		<!-- Small glue: ensure top Add buttons and any data-modal buttons open the corresponding modals regardless of modal implementation -->
		<script>
		document.addEventListener('DOMContentLoaded', function(){
		  function showModalById(id){
		    if (!id) return;
		    if (!id) return;
		    const m = document.getElementById(id);
		    if (!m) return;
		    // Prefer canonical openModal if present (it handles .modal-panel behavior)
		    if (typeof openModal === 'function') {
		      try { openModal(id); } catch (e) { console.warn('openModal threw', e); }
		      // Ensure backdrop visible as openModal may not toggle the shared backdrop element
		      const back = document.getElementById('modalBackdrop'); if (back) { back.setAttribute('aria-hidden','false'); back.classList.add('show'); }
		      // focus first input inside modal
		      try { const first = m.querySelector('input,select,textarea,button'); if (first) first.focus(); } catch(e){}
		      return;
		    }
		    // support aria-hidden/modal-panel or hidden-class modal patterns when openModal isn't available
		    // If it's the sample-style .modal wrapper
		    if (m.classList.contains('modal')) {
		      m.classList.remove('hidden');
					// ensure overlay centering
					m.style.display = 'flex';
					m.style.position = 'fixed';
					m.style.left = '0';
					m.style.top = '0';
					m.style.width = '100%';
					m.style.height = '100%';
					m.style.zIndex = '12000';
		      // append to body to avoid overflow clipping
		      if (m.parentElement !== document.body) document.body.appendChild(m);
		      const back = document.getElementById('modalBackdrop'); if (back) { back.setAttribute('aria-hidden','false'); back.classList.add('show'); }
		      try { const first = m.querySelector('input,select,textarea,button'); if (first) first.focus(); } catch(e){}
		      return;
		    }
		    // If it's a modal-panel variant
		    if (m.classList.contains('modal-panel')) {
					m.classList.remove('hidden');
					m.classList.add('open');
					// Force overlay positioning to ensure centered dialog instead of inline bottom placement
					m.style.position = 'fixed';
					m.style.left = '50%';
					m.style.top = '50%';
					m.style.transform = 'translate(-50%,-50%)';
					m.style.zIndex = '12001';
					m.style.display = 'block';
					if (m.parentElement !== document.body) document.body.appendChild(m);
					const back = document.getElementById('modalBackdrop'); if (back) { back.setAttribute('aria-hidden','false'); back.classList.add('show'); back.style.zIndex = '12000'; }
					try { const first = m.querySelector('input,select,textarea,button'); if (first) first.focus(); } catch(e){}
		      return;
		    }
		    // Generic fallback: remove hidden and show
		    m.classList.remove('hidden');
				// Generic fallback: treat as overlay
				m.style.position = 'fixed';
				m.style.left = '50%';
				m.style.top = '50%';
				m.style.transform = 'translate(-50%,-50%)';
				m.style.zIndex = '12001';
				m.style.display = 'block';
				const back = document.getElementById('modalBackdrop'); if (back) { back.setAttribute('aria-hidden','false'); back.classList.add('show'); back.style.zIndex = '12000'; }
				try { const first = m.querySelector('input,select,textarea,button'); if (first) first.focus(); } catch(e){}
		  }

		  // Explicit Add buttons
		  ['btnAddStudent','btnAddTeacher','btnAddAdmin'].forEach(function(bid){
		    const btn = document.getElementById(bid);
		    if (!btn) return;
		    btn.addEventListener('click', function(e){
		      e.preventDefault();
		      if (bid === 'btnAddStudent') showModalById('studentModal');
		      if (bid === 'btnAddTeacher') showModalById('teacherModal');
		      if (bid === 'btnAddAdmin') showModalById('adminModal');
		    });

			  // Logout button
			  var logoutBtn = document.getElementById('btnLogout');
			  if (logoutBtn) {
			    logoutBtn.addEventListener('click', async function(e){
			      e.preventDefault();
			      try {
			        // try common supabase client names
			        if (typeof supabase !== 'undefined' && supabase && supabase.auth && typeof supabase.auth.signOut === 'function') {
			          await supabase.auth.signOut();
			        } else if (typeof supabaseClient !== 'undefined' && supabaseClient && supabaseClient.auth && typeof supabaseClient.auth.signOut === 'function') {
			          await supabaseClient.auth.signOut();
			        }
			      } catch (err) {
			        console.warn('Sign out failed', err);
			      }
			      try {
			        if (typeof showToast === 'function') showToast('Signed out');
			        else if (typeof notify === 'function') notify('Signed out');
			        else window.alert('Signed out');
			      } catch (e) {}
			      // Ensure local UI preferences are not leaked (optional): do not clear localStorage here; just redirect
			      window.location.href = 'index.html';
			    });
			  }
		  });

		  // Keyboard shortcuts: S -> Students, T -> Teachers, A -> Admins (when not typing)
		  document.addEventListener('keydown', function(e) {
		    const tag = (document.activeElement && document.activeElement.tagName) || '';
		    if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;
		    if (e.key === 's' || e.key === 'S') {
		      const el = document.querySelector('[data-action="section:students"]'); if (el) el.click();
		    }
		    if (e.key === 't' || e.key === 'T') {
		      const el = document.querySelector('[data-action="section:teachers"]'); if (el) el.click();
		    }
		    if (e.key === 'a' || e.key === 'A') {
		      const el = document.querySelector('[data-action="section:admins"]'); if (el) el.click();
		    }
		  });

		  // Any element with data-modal="id" will open that modal
		  document.querySelectorAll('[data-modal]').forEach(function(el){
		    el.addEventListener('click', function(e){
		      e.preventDefault();
		      const id = el.getAttribute('data-modal');
		      showModalById(id);
		    });
		  });

		  // Any element with data-action="section:ID" will open that section in a modal
					document.querySelectorAll('[data-action]').forEach(function(el) {
						el.addEventListener('click', async function(e) {
		      const action = el.getAttribute('data-action') || '';
		      if (!action) return;
		      if (action.indexOf('section:') === 0) {
		        e.preventDefault();
		        const sectionId = action.split(':')[1];
		        // Ensure data is refreshed before showing modal
		        try {
									if (sectionId === 'students' && typeof loadStudents === 'function') await loadStudents();
									if (sectionId === 'teachers' && typeof loadTeachers === 'function') await loadTeachers();
									if (sectionId === 'admins' && typeof loadAdmins === 'function') await loadAdmins();
		        } catch (err) { /* ignore errors from loaders */ }
		        const titleMap = { students: 'Registered Students', teachers: 'Registered Teachers', admins: 'Active Admin Users' };
		        const title = titleMap[sectionId] || 'Section';
		        const modalTitle = document.getElementById('sectionModalTitle');
		        const modalBody = document.getElementById('sectionModalBody');
		        if (modalTitle) modalTitle.textContent = title;
										if (modalBody) {
											// show a spinner while we await data loaders (will be removed when content is ready)
											modalBody.innerHTML = '<div class="modal-spinner" aria-hidden="true"></div>';
											// move the original section node into the modal only after loaders complete so
											// the modal shows the ready content rather than an empty spinner
											const src = document.getElementById(sectionId);
											try {
												// append the section after we've awaited any loader above; if src exists, move it
												if (src) {
													// store original location for restore
													window._movedSection = { sectionId: sectionId, originalParent: src.parentNode, nextSibling: src.nextSibling };
																			// clear spinner then append the live section
																			modalBody.innerHTML = '';
																			modalBody.appendChild(src);
																			// Reattach select change listeners inside modal to ensure selecting items shows details
																			try {
																				const studentSelect = modalBody.querySelector('#studentSelect');
																				if (studentSelect && typeof window.showSelectedStudent === 'function') {
																					// prevent duplicate handlers
																					studentSelect.removeEventListener('change', window._modalStudentSelectHandler || function(){});
																					window._modalStudentSelectHandler = function() { try { window.showSelectedStudent(); } catch(e) { console.warn('modal showSelectedStudent failed', e); } };
																					studentSelect.addEventListener('change', window._modalStudentSelectHandler);
																					// If an option is already selected, render its details immediately
																					try { if (studentSelect.value) window.showSelectedStudent(); else {
																						// ensure the table shows the 'No student selected' row
																						try { if (typeof window.showSelectedStudent === 'function') window.showSelectedStudent(); } catch(e){}
																					} } catch(e) { console.warn('initial student render failed', e); }
																					// focus the select for keyboard users
																					try { studentSelect.focus(); } catch(e){}
																				}
																				const teacherSelect = modalBody.querySelector('#teacherSelect');
																				if (teacherSelect && typeof window.showSelectedTeacher === 'function') {
																					// Prefer the global handler when available so we don't attach duplicate listeners
																					try { teacherSelect.removeEventListener('change', window._globalTeacherSelectHandler || window._modalTeacherSelectHandler || function(){}); } catch(e){}
																					if (window._globalTeacherSelectHandler) {
																						teacherSelect.addEventListener('change', window._globalTeacherSelectHandler);
																					} else {
																						// fallback: create a modal-scoped handler but store it so it can be removed later
																						window._modalTeacherSelectHandler = function() { try { window.showSelectedTeacher(); } catch(e) { console.warn('modal showSelectedTeacher failed', e); } };
																						teacherSelect.addEventListener('change', window._modalTeacherSelectHandler);
																					}
																					try { if (teacherSelect.value) window.showSelectedTeacher(); else { try { if (typeof window.showSelectedTeacher === 'function') window.showSelectedTeacher(); } catch(e){} } } catch(e) { console.warn('initial teacher render failed', e); }
																					try { teacherSelect.focus(); } catch(e){}
																				}
																			} catch (attachErr) { console.warn('Failed to attach modal select handlers', attachErr); }
												} else {
													// If the section isn't present on this page, navigate to its canonical
													// dashboard page (as used in sample.html) so users see the full feature.
													var sectionPageMap = {
														'interestConduct': 'interest-conduct.html',
														'interestUpdate': 'dashboard.html'
													};
													if (sectionPageMap[sectionId]) {
														try { window.location.href = sectionPageMap[sectionId]; return; } catch(e) { /* fallback */ }
													}
													modalBody.innerHTML = '<div>No content available.</div>';
												}
											} catch (moveErr) {
												console.error('Error moving section into modal', moveErr);
												modalBody.innerHTML = '<div class="muted-small">Failed to load content.</div>';
											}
										}
		        // Open the modal
		        if (typeof openModal === 'function') openModal('sectionModal');
		        else document.getElementById('sectionModal') && document.getElementById('sectionModal').classList.remove('hidden');
		        return;
		      }
		      // support link:destination actions
		      if (action.indexOf('link:') === 0) {
		        const url = action.split(':')[1]; if (url) window.location.href = url;
		      }
		    });
		  });

		  // Delegate modal-close buttons
		  document.addEventListener('click', function(e){
		    const closeBtn = e.target.closest('.modal-close');
		    if (!closeBtn) return;
		    const panel = closeBtn.closest('[id]');
		    if (!panel || !panel.id) return;
		    // If closing the section modal, restore any moved section first
					try {
						if (panel.id === 'sectionModal' && window._movedSection) {
							const info = window._movedSection;
							const modalBody = document.getElementById('sectionModalBody');
							const movedEl = modalBody && modalBody.querySelector('#' + CSS.escape(info.sectionId));
							// Remove modal-specific handlers to avoid duplicates when restoring
							try {
								if (movedEl) {
									const ss = movedEl.querySelector('#studentSelect');
									if (ss && window._modalStudentSelectHandler) ss.removeEventListener('change', window._modalStudentSelectHandler);
									const ts = movedEl.querySelector('#teacherSelect');
									if (ts && window._modalTeacherSelectHandler) ts.removeEventListener('change', window._modalTeacherSelectHandler);
								}
							} catch (remErr) { console.warn('Failed to remove modal handlers during restore', remErr); }
							if (movedEl && info.originalParent) {
								info.originalParent.insertBefore(movedEl, info.nextSibling);
							}
							// clear state and modal body
							window._movedSection = null;
							if (modalBody) modalBody.innerHTML = '';
						}
		    } catch (e) { /* ignore restore errors */ }
		    if (typeof closeModal === 'function') closeModal(panel.id);
		    else { panel.classList.add('hidden'); panel.setAttribute('aria-hidden','true'); }
				const back = document.getElementById('modalBackdrop'); if (back) { back.setAttribute('aria-hidden','true'); back.classList.remove('show'); back.style.zIndex = ''; }
				// cleanup inline positioning that we may have injected
				try {
					panel.style.position = '';
					panel.style.left = '';
					panel.style.top = '';
					panel.style.transform = '';
					panel.style.zIndex = '';
					panel.style.display = '';
				} catch (e) {}
		  });
		});
		</script>
		<!-- Flip-card behavior: toggle flip on click, auto-flip, and forward back-side clicks to existing data-action handlers -->
		<script>
		(function(){
		  try {
						const cards = Array.from(document.querySelectorAll('.flip-card'));
						// Ensure flip-cards are keyboard-focusable for accessibility
						cards.forEach(function(card){
							if (!card.hasAttribute('tabindex')) card.setAttribute('tabindex','0');
		      // Toggle flip when clicking the card (but ignore clicks on interactive controls inside)
		      card.addEventListener('click', function(e){
		        if (e.target.closest('button, a, input, select, textarea')) return;
		        card.classList.toggle('flipped');
		      });

		      // Make Enter/Space toggle flip for keyboard users
		      card.addEventListener('keydown', function(e){
		        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); card.classList.toggle('flipped'); }
		      });

		      // Pause auto-flip when user hovers or focuses the card
		      card.addEventListener('mouseenter', function(){ card.dataset.paused = 'true'; });
		      card.addEventListener('mouseleave', function(){ delete card.dataset.paused; });
		      card.addEventListener('focusin', function(){ card.dataset.paused = 'true'; });
		      card.addEventListener('focusout', function(){ delete card.dataset.paused; });

		      // If back has a data-action, clicking it should trigger the action immediately
		      const back = card.querySelector('.flip-card-back[data-action]');
							if (back) {
								back.addEventListener('click', function(ev){
									ev.stopPropagation();
									const action = back.getAttribute('data-action');
									if (!action) return;
									if (action.indexOf('section:') === 0) {
										const section = action.split(':')[1];
										const el = document.querySelector('[data-action="section:' + section + '"]');
										if (el) el.click();
									} else if (action.indexOf('link:') === 0) {
										const url = action.split(':')[1]; if (url) window.location.href = url;
									} else if (action.indexOf('modal:') === 0) {
										const modalId = action.split(':')[1];
										// Prefer canonical showModalById helper if available
										try {
											if (typeof showModalById === 'function') return showModalById(modalId);
										} catch (e) {}
										try { if (typeof openModal === 'function') return openModal(modalId); } catch (e) {}
										try { const m = document.getElementById(modalId); if (m) { m.classList.remove('hidden'); } } catch (e) {}
									}
								});
							}
		    });

		    // Auto-flip controller: periodically flip a random unpaused card briefly
		    let autoFlipInterval = null;
		    function startAutoFlip(){
		      if (autoFlipInterval) return;
		      autoFlipInterval = setInterval(function(){
		        const candidates = cards.filter(c => !c.dataset.paused);
		        if (!candidates.length) return;
		        const card = candidates[Math.floor(Math.random() * candidates.length)];
		        // Flip for a short duration
		        card.classList.add('flipped');
		        setTimeout(function(){ card.classList.remove('flipped'); }, 1600);
		      }, 2600);
		    }

		    // Staggered initial flips for a lively entrance
		    cards.forEach(function(card, i){
		      setTimeout(function(){ if (!card.dataset.paused) { card.classList.add('flipped'); setTimeout(function(){ card.classList.remove('flipped'); }, 1400); } }, i * 600);
		    });

		    // Start auto flips (pauses automatically when page hidden)
		    startAutoFlip();
		    document.addEventListener('visibilitychange', function(){
		      if (document.hidden) { clearInterval(autoFlipInterval); autoFlipInterval = null; }
		      else startAutoFlip();
		    });

		  } catch (err) { console.warn('Flip-card init failed', err); }
		})();
		</script>
</body>
</html>
